---
phase: 30-frontend-build-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/build/BuildProgressBar.tsx
  - frontend/src/components/build/BuildSummary.tsx
  - frontend/src/components/build/BuildFailureCard.tsx
autonomous: true
requirements:
  - BUILD-03
  - BUILD-02

must_haves:
  truths:
    - "The build page shows a horizontal segmented progress bar with 5 named stages: Designing, Writing code, Installing dependencies, Starting app, Ready"
    - "Each stage segment has an icon from lucide-react (Wand2, Code2, Package, Play, CheckCircle2) — no emojis"
    - "Completed segments show a checkmark animation, the active segment pulses, pending segments are dimmed"
    - "An elapsed time counter is visible during the build showing Building... M:SS format — no estimates"
    - "On build success, confetti fires and the headline reads 'Your app is live!' with a prominent preview button"
    - "On build failure, a 'Contact support' link appears alongside the 'Try again' button"
  artifacts:
    - path: "frontend/src/components/build/BuildProgressBar.tsx"
      provides: "Horizontal segmented progress bar with 5 user-facing stages, icons, elapsed timer"
      exports: ["BuildProgressBar"]
      min_lines: 80
    - path: "frontend/src/components/build/BuildSummary.tsx"
      provides: "Success celebration with canvas-confetti and 'Your app is live!' headline"
      exports: ["BuildSummary"]
      min_lines: 60
    - path: "frontend/src/components/build/BuildFailureCard.tsx"
      provides: "Failure card with 'Contact support' link alongside Try again button"
      exports: ["BuildFailureCard"]
      min_lines: 40
  key_links:
    - from: "frontend/src/components/build/BuildProgressBar.tsx"
      to: "frontend/src/hooks/useBuildProgress.ts"
      via: "stageIndex prop mapped to STAGE_BAR_ITEMS segments"
      pattern: "stageIndex.*STAGE_BAR_ITEMS"
    - from: "frontend/src/components/build/BuildSummary.tsx"
      to: "canvas-confetti"
      via: "dynamic import in useEffect on mount"
      pattern: "import.*canvas-confetti"
---

<objective>
Redesign the build progress bar from circle-node stepper to horizontal segmented bar with icons, add elapsed timer, add confetti celebration to success state, and add "Contact support" to failure state.

Purpose: Delivers BUILD-03 (stage indicators) and the visual polish for BUILD-02 (failure experience). The stage bar is the primary visual element founders watch during builds — it must communicate progress clearly with plain-English labels and smooth animations.
Output: Refactored `BuildProgressBar.tsx`, updated `BuildSummary.tsx` with confetti, updated `BuildFailureCard.tsx` with "Contact support" link
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-frontend-build-ux/30-RESEARCH.md

# Existing components to modify
@frontend/src/components/build/BuildProgressBar.tsx
@frontend/src/components/build/BuildSummary.tsx
@frontend/src/components/build/BuildFailureCard.tsx
@frontend/src/hooks/useBuildProgress.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor BuildProgressBar to horizontal segmented bar with icons and elapsed timer</name>
  <files>frontend/src/components/build/BuildProgressBar.tsx</files>
  <action>
**Install canvas-confetti** (needed by Task 2 but install here to avoid parallel install conflicts):
```bash
cd frontend && npm install canvas-confetti && npm install --save-dev @types/canvas-confetti
```

**Replace the entire `BuildProgressBar.tsx`** with a horizontal segmented bar design. The current circle-node stepper is being replaced per locked decision.

**Stage mapping** (from research — maps backend STAGE_ORDER indices to user-facing labels):
```typescript
import { Wand2, Code2, Package, Play, CheckCircle2, Check } from "lucide-react";
import type { LucideIcon } from "lucide-react";

interface StageBarItem {
  key: string;
  label: string;
  icon: LucideIcon;
  backendIndex: number;  // Index in STAGE_ORDER from useBuildProgress
}

const STAGE_BAR_ITEMS: StageBarItem[] = [
  { key: "scaffold",  label: "Designing",               icon: Wand2,        backendIndex: 2 },
  { key: "code",      label: "Writing code",             icon: Code2,        backendIndex: 3 },
  { key: "deps",      label: "Installing dependencies",  icon: Package,      backendIndex: 4 },
  { key: "checks",    label: "Starting app",             icon: Play,         backendIndex: 5 },
  { key: "ready",     label: "Ready",                    icon: CheckCircle2, backendIndex: 6 },
];
```

**Updated props interface:**
```typescript
interface BuildProgressBarProps {
  stageIndex: number;       // From useBuildProgress (STAGE_ORDER index)
  totalStages: number;      // From useBuildProgress
  label: string;            // From useBuildProgress (status label — still shown as subtitle)
  status: string;           // From useBuildProgress (current status string)
  autoFixAttempt?: number | null;  // From useBuildLogs — when non-null, stage bar shows retry visual
}
```

**Segment states (derived from stageIndex vs item.backendIndex):**
- `complete`: `stageIndex > item.backendIndex` — segment fill is solid brand, icon becomes Check (checkmark)
- `active`: `stageIndex === item.backendIndex` — segment fills/pulses in brand color, icon is the stage icon with pulse animation
- `pending`: `stageIndex < item.backendIndex` — segment is dimmed, icon is muted
- Special: when `autoFixAttempt` is non-null AND status is not terminal, visually highlight the active segment in amber (amber-500) instead of brand — communicates "retrying"

**Layout — horizontal segmented bar:**
The bar is a row of 5 equal-width segments. Each segment consists of:
1. A fill bar section (thin horizontal bar that fills left-to-right when completed/active)
2. Below the bar: icon + label

Detailed structure:
```
[===filled===][===active/pulsing===][---pending---][---pending---][---pending---]
  Designing      Writing code       Installing...    Starting app     Ready
```

Implementation:
- Outer container: `flex w-full gap-1` for the segmented bar track
- Each segment: `flex-1` div
  - Top: bar segment (`h-1.5 rounded-full` — the fill bar)
    - Complete: `bg-brand` solid fill
    - Active: `bg-brand` with framer-motion pulse animation (opacity 0.6 → 1.0 → 0.6, repeat)
    - Active + autoFix: `bg-amber-500` with pulse (amber color for retry state)
    - Pending: `bg-white/10`
  - Bottom: `flex flex-col items-center mt-3 gap-1`
    - Icon: appropriate lucide icon, `w-4 h-4`
      - Complete: `Check` icon with `text-brand` and a spring scale-in animation
      - Active: stage icon with `text-white` (or `text-amber-400` during autofix)
      - Pending: stage icon with `text-white/30`
    - Label: `text-xs text-center leading-tight`
      - Complete: `text-brand`
      - Active: `text-white` (or `text-amber-300` during autofix)
      - Pending: `text-white/30`

**Completed segment checkmark animation:**
When a segment transitions from active to complete, use framer-motion:
```typescript
<motion.div
  initial={{ scale: 0 }}
  animate={{ scale: 1 }}
  transition={{ type: "spring", stiffness: 300, damping: 20 }}
>
  <Check className="w-4 h-4 text-brand" strokeWidth={2.5} />
</motion.div>
```

**Active segment pulse animation:**
```typescript
<motion.div
  className="h-1.5 rounded-full bg-brand"  // or bg-amber-500 during autofix
  animate={{ opacity: [0.6, 1, 0.6] }}
  transition={{ duration: 1.5, repeat: Infinity, ease: "easeInOut" }}
/>
```

**Elapsed timer** (below the segmented bar):
- State: `elapsed` (number, seconds), `startTimeRef` (ref to start timestamp)
- `useEffect` on `isBuilding` changing:
  - If building starts (isBuilding becomes true): set `startTimeRef.current = Date.now()`
  - Start `setInterval(1000)` that updates `elapsed = Math.floor((Date.now() - startTimeRef.current) / 1000)`
  - If not building: clear interval
  - Cleanup: clear interval
- Format function: `formatElapsed(seconds: number): string` → `${Math.floor(seconds / 60)}:${String(seconds % 60).padStart(2, '0')}`
- Display: centered below the bar, `text-sm text-white/40 font-mono mt-4`
  - While building: `Building... {formatElapsed(elapsed)}`
  - Show only when `isBuilding && elapsed > 0`

**Remove the old pulsing indeterminate bar** that was below the circle stepper — replaced by the segmented bar itself. The old label that was shown above the stepper is also removed — the stage labels serve that purpose now.

**Keep the `status` label as a subtle subtitle** below the elapsed timer, only shown during building: `text-xs text-white/30 mt-1 text-center` — this gives the backend's more detailed status message (e.g., "Scaffolding workspace...") while the bar shows the high-level "Designing" label.
  </action>
  <verify>
1. `cd frontend && npx tsc --noEmit` — no type errors
2. Verify `canvas-confetti` is in `package.json` dependencies
3. Verify `@types/canvas-confetti` is in devDependencies
4. Grep for `STAGE_BAR_ITEMS` in the file — confirms 5 stages defined
5. Grep for `formatElapsed` — confirms elapsed timer function exists
6. Grep for `autoFixAttempt` — confirms amber styling branch exists
  </verify>
  <done>
`BuildProgressBar.tsx` renders a horizontal segmented bar with 5 stages (Designing, Writing code, Installing dependencies, Starting app, Ready), lucide icons, checkmark animations on completion, pulse on active, amber highlight during auto-fix, and elapsed timer in Building... M:SS format. canvas-confetti is installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add confetti to BuildSummary and "Contact support" to BuildFailureCard</name>
  <files>
frontend/src/components/build/BuildSummary.tsx
frontend/src/components/build/BuildFailureCard.tsx
  </files>
  <action>
**Part A: Update `BuildSummary.tsx` — confetti celebration**

Per locked decision: "Celebration moment: confetti or animation, 'Your app is live!' with prominent preview button."

1. Add confetti trigger function using dynamic import (avoids SSR issues — Pitfall 3 from research):
```typescript
async function triggerConfetti() {
  const confetti = (await import("canvas-confetti")).default;
  // Main burst from bottom center
  confetti({
    particleCount: 80,
    spread: 70,
    origin: { x: 0.5, y: 0.8 },
    colors: ["#6467f2", "#8183f5", "#0df2f2", "#ffffff"],
    zIndex: 9999,
  });
  // Follow-up burst 300ms later for lingering effect
  setTimeout(() => {
    confetti({
      particleCount: 40,
      spread: 50,
      origin: { x: 0.4, y: 0.75 },
      colors: ["#6467f2", "#8183f5"],
      zIndex: 9999,
    });
  }, 300);
}
```

2. Add `useEffect` with empty deps to trigger confetti once on mount:
```typescript
useEffect(() => {
  triggerConfetti();
}, []);
```

3. Update the headline text:
   - Change `"Your MVP is ready!"` to `"Your app is live!"`
   - Change `"We shipped your first working preview."` to `"We built your first working preview — take a look."`

4. Update the preview CTA button text from `"Open Preview"` to `"Open your app"` — more personal and exciting

**Part B: Update `BuildFailureCard.tsx` — add "Contact support" link**

Per locked decision: "Recovery actions: 'Try again' button and 'Contact support' link — two clear paths"

1. Add `import { Mail } from "lucide-react"` (or use existing imports)

2. After the "Try again" button and before the expandable details section, add a "Contact support" link:
```tsx
{/* Contact support — secondary recovery path */}
<a
  href="mailto:hello@getinsourced.ai?subject=Build%20failure%20-%20debug%20ID%20{debugId}"
  className="inline-flex items-center gap-1.5 text-sm text-white/40 hover:text-white/60 transition-colors"
>
  <Mail className="w-3.5 h-3.5" />
  Contact support
</a>
```

The `href` should dynamically include the `debugId` in the subject line for support context:
```tsx
href={`mailto:hello@getinsourced.ai?subject=${encodeURIComponent(`Build failure - debug ID ${debugId}`)}`}
```

3. Update the subtitle text to be more reassuring (per locked decision: "Short friendly error message"):
   - Change the subtitle from `"Want us to try again? We'll pick up from where things left off."` to `"Don't worry — this happens sometimes. Here's what you can do:"`
  </action>
  <verify>
1. `cd frontend && npx tsc --noEmit` — no type errors
2. Grep for `canvas-confetti` in `BuildSummary.tsx` — confirms dynamic import
3. Grep for `"Your app is live"` in `BuildSummary.tsx` — confirms updated headline
4. Grep for `mailto:hello@getinsourced.ai` in `BuildFailureCard.tsx` — confirms support link
5. Grep for `Contact support` in `BuildFailureCard.tsx` — confirms link text
  </verify>
  <done>
`BuildSummary.tsx` fires a confetti burst on mount via dynamic canvas-confetti import, headline says "Your app is live!" with "Open your app" CTA. `BuildFailureCard.tsx` includes a "Contact support" mailto link with debug ID in the subject alongside the "Try again" button.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` passes — all modified components compile
2. `canvas-confetti` and `@types/canvas-confetti` appear in `package.json`
3. The segmented bar has exactly 5 stages matching the locked decision labels
4. Elapsed timer displays during build in M:SS format
5. Confetti triggers via dynamic import (no SSR crash risk)
6. "Contact support" link exists in failure card with mailto href
</verification>

<success_criteria>
- The progress bar is a horizontal segmented design with 5 labeled stages and lucide icons
- Active segment pulses, completed segments show animated checkmark, pending segments are dimmed
- Elapsed timer shows "Building... 0:42" format during builds
- Auto-fix state renders segments in amber (prop support ready for Plan 03 wiring)
- Build success triggers confetti celebration with "Your app is live!" headline
- Build failure shows both "Try again" button and "Contact support" mailto link
</success_criteria>

<output>
After completion, create `.planning/phases/30-frontend-build-ux/30-02-SUMMARY.md`
</output>
