---
phase: 07-state-machine-integration-dashboard
plan: 04
type: execute
wave: 3
depends_on: ["07-03"]
files_modified:
  - frontend/src/components/ui/slide-over.tsx
  - frontend/src/components/dashboard/artifact-panel.tsx
  - frontend/src/app/(dashboard)/company/[projectId]/page.tsx
autonomous: false

must_haves:
  truths:
    - "Clicking an artifact card opens a slide-over panel from the right"
    - "Panel shows artifact content in collapsible/expandable sections"
    - "Panel header has action buttons: Regenerate, Export PDF, Export Markdown, Edit"
    - "Dashboard remains visible behind the semi-transparent backdrop"
    - "Cards that changed during polling get a brief highlight pulse and toast notification"
    - "Generating artifacts show skeleton shimmer in their card"
  artifacts:
    - path: "frontend/src/components/ui/slide-over.tsx"
      provides: "Reusable slide-over panel using shadcn Sheet or Radix Dialog"
      contains: "export function SlideOver"
    - path: "frontend/src/components/dashboard/artifact-panel.tsx"
      provides: "Artifact detail panel with collapsible sections and action buttons"
      contains: "export function ArtifactPanel"
    - path: "frontend/src/app/(dashboard)/company/[projectId]/page.tsx"
      provides: "Updated page wiring slide-over, toast, and change animations"
      contains: "SlideOver"
  key_links:
    - from: "frontend/src/app/(dashboard)/company/[projectId]/page.tsx"
      to: "frontend/src/components/ui/slide-over.tsx"
      via: "SlideOver import and usage"
      pattern: "SlideOver"
    - from: "frontend/src/components/dashboard/artifact-panel.tsx"
      to: "/api/artifacts/{id}"
      via: "apiFetch for full artifact content"
      pattern: "apiFetch.*artifacts"
    - from: "frontend/src/app/(dashboard)/company/[projectId]/page.tsx"
      to: "sonner"
      via: "toast notification import"
      pattern: "from 'sonner'"
---

<objective>
Artifact drill-down slide-over panel with collapsible sections, action buttons, and toast notifications for live updates.

Purpose: Complete the dashboard drill-down experience. When a founder clicks an artifact card, a panel slides in from the right showing full content with section-by-section navigation and action buttons. Toast notifications alert founders to changes detected during polling. This completes DASH-02 (cards that drill down into rich documents).
Output: Slide-over panel component, artifact detail panel, and toast integration.
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-state-machine-integration-dashboard/07-RESEARCH.md
@.planning/phases/07-state-machine-integration-dashboard/07-03-SUMMARY.md

Key existing code:
@frontend/src/app/(dashboard)/company/[projectId]/page.tsx — Dashboard page from Plan 03
@frontend/src/hooks/useDashboard.ts — Polling hook with changedFields
@frontend/src/lib/api.ts — apiFetch
@frontend/src/components/dashboard/artifact-card.tsx — Card component from Plan 03
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SlideOver component and ArtifactPanel with collapsible sections</name>
  <files>
    frontend/src/components/ui/slide-over.tsx
    frontend/src/components/dashboard/artifact-panel.tsx
  </files>
  <action>
    1. Install sonner for toast notifications:
       `cd frontend && npm install sonner`

    2. Create frontend/src/components/ui/slide-over.tsx:
       - Use shadcn Sheet component pattern (Radix Dialog primitive) or build custom:
         * Import Dialog primitives from @radix-ui/react-dialog (already available via shadcn)
         * OR use Framer Motion for slide animation
       - SlideOver({ open, onClose, title, children }: SlideOverProps)
       - Layout:
         * Fixed overlay: bg-black/50 backdrop-blur-sm z-40
         * Panel: fixed right-0 top-0 bottom-0 w-full max-w-2xl bg-obsidian border-l border-white/10 shadow-2xl z-50
         * Slide animation from right: Use Framer Motion or CSS transition
           - Initial: translateX(100%)
           - Animate: translateX(0)
           - Exit: translateX(100%)
         * Header with title and close button (X icon from lucide-react)
         * Scrollable content area (overflow-y-auto)
       - Focus trap and ESC key handling (Radix Dialog handles this automatically)
       - Key prop for remount when switching artifacts (research pitfall 4)

    3. Create frontend/src/components/dashboard/artifact-panel.tsx:
       - ArtifactPanel({ artifactId, projectId, onClose }: ArtifactPanelProps)
       - Fetches FULL artifact content via GET /api/artifacts/{artifactId} (existing endpoint from Phase 6)
       - Uses useAuth() + apiFetch for authenticated request
       - Internal state: artifact content, loading, expanded sections set

       Header section:
       - Artifact type as title (e.g., "Product Brief")
       - Action buttons row: Regenerate, Export PDF, Export Markdown, Edit
       - Per user decision: action buttons in panel header
       - Regenerate: calls POST /api/artifacts/{id}/regenerate
       - Export PDF: calls GET /api/artifacts/{id}/export/pdf (Phase 6 endpoint)
       - Export Markdown: calls GET /api/artifacts/{id}/export/markdown (Phase 6 endpoint)
       - Edit: toggles edit mode (Claude's discretion - use edit mode toggle per expandable section pattern)
       - Each button uses appropriate Lucide icon: RefreshCw, FileDown, FileText, Pencil

       Content sections:
       - Parse artifact content JSONB into sections
       - Each section rendered as a collapsible card:
         * Section title + chevron icon (ChevronDown/ChevronUp)
         * Click toggles expanded/collapsed state
         * Expanded: shows section content as formatted text
         * Use Set<string> for expanded section tracking
         * First 2 sections expanded by default (show key info immediately)
       - Per user decision: collapsible/expandable cards for drill-down scanning

       Inline editing (Claude's discretion - edit mode toggle):
       - When Edit button clicked: sections become editable
       - Each expanded section shows a Save button when in edit mode
       - Use controlled textarea for editing (per Phase 4 decision)
       - On save: call PATCH /api/artifacts/{id}/edit with section_path and new content
       - Show loading spinner during save, optimistic update after

       Error state:
       - If fetch fails: show error with retry button
       - If action fails: show toast error message

       Loading state:
       - Skeleton blocks for header and sections while fetching full artifact
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit --pretty 2>&1 | head -20` — no TypeScript errors
  </verify>
  <done>
    SlideOver and ArtifactPanel components created. Panel fetches full artifact content,
    shows collapsible sections, and has action buttons for Regenerate/Export/Edit.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire slide-over panel and toast notifications into dashboard page</name>
  <files>
    frontend/src/app/(dashboard)/company/[projectId]/page.tsx
    frontend/src/app/layout.tsx
  </files>
  <action>
    1. Add Toaster to root layout:
       - In frontend/src/app/layout.tsx: import { Toaster } from 'sonner'
       - Add <Toaster position="top-right" theme="dark" richColors /> inside the body, after {children}
       - This enables toast() calls from any component

    2. Update frontend/src/app/(dashboard)/company/[projectId]/page.tsx:
       - Import SlideOver from @/components/ui/slide-over
       - Import ArtifactPanel from @/components/dashboard/artifact-panel
       - Import { toast } from 'sonner'

       Wire slide-over panel:
       - selectedArtifactId state already exists from Plan 03
       - When ArtifactCard onClick fires: setSelectedArtifactId(artifact.id)
       - Render SlideOver at bottom of page:
         * open={selectedArtifactId !== null}
         * onClose={() => setSelectedArtifactId(null)}
         * title={selected artifact type label}
         * Children: <ArtifactPanel artifactId={selectedArtifactId} projectId={projectId} onClose={() => setSelectedArtifactId(null)} />
       - Use key={selectedArtifactId} on SlideOver for remount when switching artifacts

       Add toast notifications for polling changes:
       - Use useEffect watching changedFields from useDashboard:
         * If changedFields.has('artifacts'): check what changed
           - Compare current vs previous artifact statuses
           - If any artifact went from 'generating' to 'idle': toast.success('Artifact generation completed')
           - If any artifact went from any status to 'failed': toast.error('Artifact generation failed')
         * If changedFields.has('progress'): toast.success(`Progress updated: ${data.mvp_completion_percent}%`)
       - Per user decision: toast + pulse animation for changes noticed without being intrusive
       - Per research recommendation: Toast only for status changes (not every content update)

       Pulse animation on changed cards:
       - ArtifactCard already accepts isChanged prop from Plan 03
       - Pass isChanged={changedFields.has('artifacts')} to each card
       - The Framer Motion scale animation in ArtifactCard handles the pulse

    3. Verify no version UI surfaced:
       - Per user decision: "No version UI surfaced to founders — versions exist in backend only"
       - ArtifactCard should NOT show version number to founders
       - ArtifactPanel should NOT show version number
       - version_number exists in data for backend tracking only
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit --pretty 2>&1 | head -20` — no TypeScript errors
  </verify>
  <done>
    Dashboard page wires slide-over panel for artifact drill-down.
    Toast notifications fire on artifact generation completion/failure.
    Pulse animation highlights changed cards.
    No version numbers visible to founders.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify dashboard visual and interactive behavior</name>
  <files>frontend/src/app/(dashboard)/company/[projectId]/page.tsx</files>
  <action>
    CHECKPOINT: Human verification of complete dashboard experience.

    What was built:
    - Complete Company dashboard at /company/{projectId}
    - Circular stage ring showing current stage and progress percentage
    - Action-oriented hero showing "what to do next"
    - Artifact cards in grid with shimmer for generating state
    - Slide-over panel opening from right on card click
    - Collapsible sections in panel with action buttons
    - Risk flags shown only when active
    - Auto-polling every ~7 seconds
    - Toast notifications for status changes

    How to verify:
    1. Navigate to http://localhost:3000/company/{your-project-id}
    2. Verify layout: stage ring and action hero side-by-side in top row, artifact cards below in grid, risk flags only visible if project has risks
    3. Click an artifact card: slide-over panel opens from right, dashboard visible behind, panel shows collapsible sections with Regenerate/Export PDF/Export Markdown/Edit buttons
    4. Close panel via X button, backdrop click, or ESC key
    5. Wait 7-10 seconds: check browser Network tab for polling requests
    6. Verify clean aesthetic: no version numbers visible, intuitive layout

    Resume signal: Type "approved" or describe any visual/interaction issues to fix
  </action>
  <verify>User confirms dashboard renders correctly with all interactive elements working</verify>
  <done>Dashboard visual and interactive behavior approved by user</done>
</task>

</tasks>

<verification>
- `cd frontend && npx tsc --noEmit` — no TypeScript errors
- Navigate to /company/{projectId} — dashboard renders with all components
- Click artifact card — slide-over opens from right
- Close slide-over — ESC, click backdrop, or click X all work
- Check Network tab — polling visible every ~7 seconds
- sonner toast appears when status changes detected
</verification>

<success_criteria>
- Artifact cards drill down into rich documents via slide-over panel (DASH-02)
- Panel has collapsible sections and action buttons per user decision
- Toast notifications fire on artifact generation completion/failure
- Pulse animation highlights changed cards
- No version numbers visible to founders
- Dashboard behind panel remains visible (semi-transparent backdrop)
- All interactive behaviors work (click, close, collapse/expand)
</success_criteria>

<output>
After completion, create `.planning/phases/07-state-machine-integration-dashboard/07-04-SUMMARY.md`
</output>
