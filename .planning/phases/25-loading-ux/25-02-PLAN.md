---
phase: 25-loading-ux
plan: 02
type: execute
wave: 2
depends_on: [25-01]
files_modified:
  - marketing/src/components/marketing/loading/route-progress-bar.tsx
  - marketing/src/components/marketing/loading/skeleton-templates.tsx
  - marketing/src/components/marketing/loading/page-content-wrapper.tsx
  - marketing/src/app/(marketing)/layout.tsx
  - marketing/src/app/globals.css
  - marketing/src/app/(marketing)/page.tsx
  - marketing/src/app/(marketing)/cofounder/page.tsx
  - marketing/src/app/(marketing)/pricing/page.tsx
  - marketing/src/app/(marketing)/about/page.tsx
  - marketing/src/app/(marketing)/contact/page.tsx
  - marketing/src/app/(marketing)/privacy/page.tsx
  - marketing/src/app/(marketing)/terms/page.tsx
  - marketing/src/app/(marketing)/cofounder/how-it-works/page.tsx
autonomous: true
requirements: [LOAD-04, LOAD-05, LOAD-06]

must_haves:
  truths:
    - "Navigating between pages shows a slim animated-gradient progress bar at the top of the viewport"
    - "The progress bar has a trailing glow effect behind its leading edge"
    - "Pages show skeleton placeholder shapes matching their layout type while content loads"
    - "Content fades in simultaneously over skeletons as a single crossfade transition"
    - "The progress bar does NOT appear on initial page load (only on SPA navigations)"
  artifacts:
    - path: "marketing/src/components/marketing/loading/route-progress-bar.tsx"
      provides: "Client component: usePathname-based animated gradient progress bar with glow"
      min_lines: 40
    - path: "marketing/src/components/marketing/loading/skeleton-templates.tsx"
      provides: "HeroSkeleton, ListSkeleton, ContentSkeleton with shimmer-diagonal animation"
      min_lines: 50
    - path: "marketing/src/components/marketing/loading/page-content-wrapper.tsx"
      provides: "Client component wrapping page content with skeleton-to-content crossfade"
      min_lines: 30
    - path: "marketing/src/app/globals.css"
      provides: "progress-gradient keyframe, shimmer-diagonal keyframe, skeleton utility classes"
      contains: "progress-gradient"
  key_links:
    - from: "marketing/src/app/(marketing)/layout.tsx"
      to: "marketing/src/components/marketing/loading/route-progress-bar.tsx"
      via: "RouteProgressBar component in layout"
      pattern: "<RouteProgressBar"
    - from: "marketing/src/components/marketing/loading/page-content-wrapper.tsx"
      to: "marketing/src/components/marketing/loading/skeleton-templates.tsx"
      via: "Skeleton prop passed to wrapper component"
      pattern: "skeleton"
    - from: "page.tsx files"
      to: "marketing/src/components/marketing/loading/page-content-wrapper.tsx"
      via: "PageContentWrapper wrapping page children"
      pattern: "PageContentWrapper"
---

<objective>
Add a route progress bar that appears during SPA navigations with an animated gradient and glow trail, skeleton placeholder templates that match page layouts, and a content wrapper that crossfades from skeleton to real content.

Purpose: Every page transition feels smooth and polished — no blank white areas, no abrupt content pops.
Output: route-progress-bar.tsx, skeleton-templates.tsx, page-content-wrapper.tsx components, CSS keyframes, integration across all 8 pages.
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-loading-ux/25-RESEARCH.md
@.planning/phases/25-loading-ux/25-01-SUMMARY.md
@marketing/src/app/(marketing)/layout.tsx
@marketing/src/app/globals.css
@marketing/src/components/marketing/navbar.tsx
@marketing/src/app/(marketing)/page.tsx
@marketing/src/app/(marketing)/cofounder/page.tsx
@marketing/src/app/(marketing)/pricing/page.tsx
@marketing/src/app/(marketing)/about/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create progress bar, skeleton templates, and content wrapper components plus CSS</name>
  <files>
    marketing/src/components/marketing/loading/route-progress-bar.tsx
    marketing/src/components/marketing/loading/skeleton-templates.tsx
    marketing/src/components/marketing/loading/page-content-wrapper.tsx
    marketing/src/app/globals.css
  </files>
  <action>
**route-progress-bar.tsx** — "use client" component:

1. Imports: `motion`, `useSpring`, `useMotionValue`, `useTransform` from framer-motion. `usePathname` from `next/navigation`. `useEffect`, `useRef`, `useState` from react.

2. Track route changes:
   - `const pathname = usePathname()`
   - `const prevPath = useRef<string | null>(null)` — initialize as `null` (NOT pathname) to prevent triggering on initial load (per research pitfall #3).
   - `const [isAnimating, setIsAnimating] = useState(false)`
   - `const progress = useMotionValue(0)`
   - `const springProgress = useSpring(progress, { stiffness: 80, damping: 25 })`
   - `const width = useTransform(springProgress, [0, 100], ["0%", "100%"])`

3. useEffect on pathname change:
   ```
   useEffect(() => {
     if (prevPath.current !== null && prevPath.current !== pathname) {
       setIsAnimating(true);
       progress.set(0);
       requestAnimationFrame(() => progress.set(100));
       const timer = setTimeout(() => setIsAnimating(false), 700);
       prevPath.current = pathname;
       return () => clearTimeout(timer);
     }
     prevPath.current = pathname;
   }, [pathname, progress]);
   ```
   First render: `prevPath.current` is null, so just set it to pathname. Subsequent: detect change, animate, then hide.

4. Render:
   - Outer: `motion.div` with `className="fixed top-0 left-0 right-0 z-[9998] pointer-events-none"` and `style={{ opacity: isAnimating ? 1 : 0, transition: "opacity 0.3s ease-out" }}`. Height: `h-[3px]` (3px — discretion: in the 2-4px range, 3px is a good balance).
   - Inner: `motion.div` with `className="h-full animate-progress-gradient rounded-r-full"` and `style={{ width, boxShadow: "0 0 10px rgba(100,103,242,0.7), 0 0 20px rgba(100,103,242,0.4)" }}`.
   - The boxShadow creates the trailing glow effect behind the leading edge.

**skeleton-templates.tsx** — "use client" component:

1. Helper `SkeletonBlock` component:
   ```tsx
   function SkeletonBlock({ className }: { className?: string }) {
     return (
       <div className={cn("relative overflow-hidden rounded-lg bg-white/[0.04]", className)}>
         <div className="absolute inset-0 -translate-x-full animate-shimmer-diagonal bg-gradient-to-r from-transparent via-white/[0.06] to-transparent" />
       </div>
     );
   }
   ```
   Skeleton shape colors: `bg-white/[0.04]` base with `via-white/[0.06]` shimmer — neutral gray on obsidian background (discretion choice: neutral, not brand-tinted). Corner radius: `rounded-lg` matching design tokens (0.5rem from --radius).

2. `HeroSkeleton` — for pages with hero sections (home, cofounder, how-it-works):
   - Container: `max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-20` (matches hero padding in actual pages).
   - SkeletonBlock for badge: `h-7 w-40 rounded-full` (the pill badge above headlines).
   - SkeletonBlock for h1: `h-12 w-[70%] mt-6` (headline).
   - SkeletonBlock for h1 line 2: `h-12 w-[50%] mt-3`.
   - SkeletonBlock for subtitle: `h-5 w-[60%] mt-6`.
   - SkeletonBlock for subtitle line 2: `h-5 w-[45%] mt-2`.
   - SkeletonBlock for CTA button: `h-12 w-48 mt-8 rounded-xl`.

3. `ListSkeleton` — for pages with card grids (pricing, about):
   - Container: `max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-20`.
   - SkeletonBlock for heading: `h-10 w-[40%] mx-auto`.
   - SkeletonBlock for subheading: `h-5 w-[55%] mx-auto mt-4`.
   - Grid: `grid grid-cols-1 md:grid-cols-3 gap-6 mt-12`.
   - 3x card SkeletonBlock: `h-72 rounded-2xl` each.

4. `ContentSkeleton` — for long-form pages (privacy, terms, contact):
   - Container: `max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-20`.
   - SkeletonBlock for heading: `h-10 w-[50%]`.
   - SkeletonBlock for paragraph: `h-4 w-full mt-6` (repeat 4 lines with varying widths: 100%, 95%, 88%, 70%).
   - SkeletonBlock for section heading: `h-7 w-[35%] mt-10`.
   - SkeletonBlock for paragraph: `h-4 w-full mt-4` (repeat 3 lines: 100%, 92%, 80%).

5. Export all three: `HeroSkeleton`, `ListSkeleton`, `ContentSkeleton`.

**page-content-wrapper.tsx** — "use client" component:

1. Props: `{ children: React.ReactNode; skeleton: React.ReactNode }`

2. State: `const [isLoading, setIsLoading] = useState(true)`

3. useEffect on mount:
   ```
   useEffect(() => {
     const id = requestAnimationFrame(() => setIsLoading(false));
     return () => cancelAnimationFrame(id);
   }, []);
   ```
   Uses `requestAnimationFrame` (not `setTimeout`) so the skeleton resolves in the next paint frame — near instant on fast connections, visible on slow ones.

4. Render with AnimatePresence mode="wait":
   ```tsx
   <AnimatePresence mode="wait">
     {isLoading ? (
       <motion.div key="skeleton" exit={{ opacity: 0 }} transition={{ duration: 0.15 }}>
         {skeleton}
       </motion.div>
     ) : (
       <motion.div key="content" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.3 }}>
         {children}
       </motion.div>
     )}
   </AnimatePresence>
   ```
   Content crossfade duration: 0.3s (discretion choice: shorter than splash dismiss 0.4s, doesn't conflict with hero-fade 0.15s).

5. The entire page crossfades simultaneously — no staggered reveal (per locked decision).

**globals.css additions** — add AFTER the existing `[data-no-splash]` rule (added in Plan 01) and BEFORE the reduced-motion block:

```css
/* Progress bar — animated gradient that shifts colors */
@keyframes progress-gradient {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.animate-progress-gradient {
  background: linear-gradient(90deg, #6467f2, #0df2f2, #8183f5, #00ff9d, #6467f2);
  background-size: 300% 100%;
  animation: progress-gradient 2s linear infinite;
}

/* Skeleton shimmer — diagonal sweep (Stripe-style) */
@keyframes shimmer-diagonal {
  0%   { transform: translateX(-200%) skewX(-15deg); }
  100% { transform: translateX(200%) skewX(-15deg); }
}

.animate-shimmer-diagonal {
  animation: shimmer-diagonal 1.8s ease-in-out infinite;
}
```

NOTE: These new keyframe animations WILL be affected by the existing `@media (prefers-reduced-motion: reduce)` block which sets `animation-duration: 0.01ms !important`. This is correct — reduced-motion users should NOT see shimmer or gradient animations. The MotionConfig in MarketingLayout also covers all framer-motion animations. No additional reduced-motion handling needed.
  </action>
  <verify>
Run `cd /Users/vladcortex/co-founder/marketing && npm run build` — build succeeds. Verify all three new files exist in `marketing/src/components/marketing/loading/`. Verify globals.css contains `progress-gradient` and `shimmer-diagonal` keyframes.
  </verify>
  <done>
RouteProgressBar detects pathname changes and renders animated gradient bar with glow at top of viewport. Three skeleton templates (Hero, List, Content) match page layout structures with diagonal shimmer animation. PageContentWrapper provides skeleton-to-content crossfade using AnimatePresence. CSS keyframes for progress gradient and shimmer sweep are in globals.css. All respect reduced-motion automatically.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire progress bar into layout and skeleton wrappers into all 8 pages</name>
  <files>
    marketing/src/app/(marketing)/layout.tsx
    marketing/src/app/(marketing)/page.tsx
    marketing/src/app/(marketing)/cofounder/page.tsx
    marketing/src/app/(marketing)/pricing/page.tsx
    marketing/src/app/(marketing)/about/page.tsx
    marketing/src/app/(marketing)/contact/page.tsx
    marketing/src/app/(marketing)/privacy/page.tsx
    marketing/src/app/(marketing)/terms/page.tsx
    marketing/src/app/(marketing)/cofounder/how-it-works/page.tsx
  </files>
  <action>
**marketing/src/app/(marketing)/layout.tsx** — Add RouteProgressBar:

Import `RouteProgressBar` from `@/components/marketing/loading/route-progress-bar`. Add it inside the MotionConfig wrapper, before `<main>`:

```tsx
<MotionConfig reducedMotion="user">
  <RouteProgressBar />
  <main>{children}</main>
</MotionConfig>
```

Place inside MotionConfig so reduced-motion settings are inherited. The progress bar uses framer-motion `useSpring`/`useMotionValue` which respect MotionConfig.

**Page integration — wrap each page's content component with PageContentWrapper:**

For each page, the pattern is:
1. The page.tsx file stays as a SERVER component (it exports metadata).
2. Import `PageContentWrapper` and the appropriate skeleton from the loading directory.
3. Wrap the content component with `PageContentWrapper` passing the correct skeleton.

Since page.tsx files are server components and PageContentWrapper is a client component, this is the correct Next.js pattern — server component renders client component as a child.

**Homepage** (`(marketing)/page.tsx`):
```tsx
import { PageContentWrapper } from "@/components/marketing/loading/page-content-wrapper";
import { HeroSkeleton } from "@/components/marketing/loading/skeleton-templates";
// ... existing imports

export default function HomePage() {
  return (
    <PageContentWrapper skeleton={<HeroSkeleton />}>
      <InsourcedHomeContent />
    </PageContentWrapper>
  );
}
```

**Cofounder page** (`(marketing)/cofounder/page.tsx`):
- Uses `HeroSkeleton`. Wrap the entire JSX return (the fragment with JSON-LD script + HomeContent) in PageContentWrapper.

**How It Works** (`(marketing)/cofounder/how-it-works/page.tsx`):
- Uses `HeroSkeleton`.

**Pricing** (`(marketing)/pricing/page.tsx`):
- Uses `ListSkeleton`.

**About** (`(marketing)/about/page.tsx`):
- Uses `ListSkeleton`.

**Contact** (`(marketing)/contact/page.tsx`):
- Uses `ContentSkeleton`.

**Privacy** (`(marketing)/privacy/page.tsx`):
- Uses `ContentSkeleton`.

**Terms** (`(marketing)/terms/page.tsx`):
- Uses `ContentSkeleton`.

For each page, add the two imports (`PageContentWrapper` + appropriate skeleton) and wrap the returned JSX. Do NOT change the metadata exports or any server-side logic.

IMPORTANT: The `PageContentWrapper` is a client component. When used in a server component page, the children passed to it become its children prop. The content components (InsourcedHomeContent, HomeContent, PricingContent, etc.) that are already client components will work fine as children. For server-rendered pages (about, privacy, terms) that render JSX directly, the JSX becomes the children — Next.js handles the serialization boundary.
  </action>
  <verify>
Run `cd /Users/vladcortex/co-founder/marketing && npm run build` — build succeeds with zero errors. Check that `out/index.html` does NOT contain the string "skeleton" in visible text (skeletons are client-rendered). Check that `out/pricing/index.html` exists (routing still works). Optionally run `npx serve out -l 3333` and navigate between pages to confirm progress bar appears on navigation.
  </verify>
  <done>
RouteProgressBar renders in the marketing layout on every SPA navigation with animated gradient + glow. All 8 pages are wrapped with PageContentWrapper using the appropriate skeleton template (HeroSkeleton for home/cofounder/how-it-works, ListSkeleton for pricing/about, ContentSkeleton for contact/privacy/terms). Content crossfades in simultaneously over skeletons. Build passes clean.
  </done>
</task>

</tasks>

<verification>
1. `cd /Users/vladcortex/co-founder/marketing && npm run build` passes with zero errors
2. All 4 new component files exist in `marketing/src/components/marketing/loading/`
3. `grep -c 'RouteProgressBar' marketing/src/app/\(marketing\)/layout.tsx` returns 1+
4. `grep -c 'PageContentWrapper' marketing/src/app/\(marketing\)/page.tsx` returns 1+
5. `grep -c 'PageContentWrapper' marketing/src/app/\(marketing\)/pricing/page.tsx` returns 1+
6. `grep -c 'progress-gradient' marketing/src/app/globals.css` returns 1+
7. `grep -c 'shimmer-diagonal' marketing/src/app/globals.css` returns 1+
8. `ls marketing/out/pricing/index.html` — exists (pages still build correctly)
</verification>

<success_criteria>
- RouteProgressBar shows animated gradient bar with glow on SPA navigations only (not initial load)
- Three skeleton templates (Hero, List, Content) match page layout structure with diagonal shimmer
- All 8 pages wrapped with PageContentWrapper that crossfades from skeleton to content
- Progress bar is 3px thick at top of viewport with brand color gradient shifting
- Content crossfade is simultaneous (entire page at once), not staggered
- All animations respect prefers-reduced-motion via existing CSS block and MotionConfig
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-loading-ux/25-02-SUMMARY.md`
</output>
