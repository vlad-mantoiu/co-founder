---
phase: 22.1-end-to-end-flow
plan: 03
type: execute
wave: 2
depends_on:
  - "22.1-01"
files_modified:
  - frontend/src/app/(dashboard)/projects/[id]/strategy/page.tsx
  - frontend/src/components/strategy-graph/ForceGraphInner.tsx
  - frontend/src/components/strategy-graph/StrategyGraphCanvas.tsx
  - frontend/src/app/(dashboard)/projects/[id]/timeline/page.tsx
  - frontend/src/components/timeline/MvpTimeline.tsx
autonomous: true
requirements:
  - E2E-STRATEGY
  - E2E-TIMELINE
must_haves:
  truths:
    - "Strategy page displays anchor nodes (user's verbatim words) in amber and strategy nodes in pink from artifact JSONB"
    - "Strategy graph force layout shows anchor-to-strategy connections with readable labels"
    - "Timeline page shows personalized MVP milestones with relative weeks and 2-3 deliverables per milestone"
    - "Timeline milestones adapt scope/duration based on the user's tier"
  artifacts:
    - path: "frontend/src/app/(dashboard)/projects/[id]/strategy/page.tsx"
      provides: "Dual-mode strategy page (artifact graph OR Neo4j graph)"
      contains: "strategy_graph.*artifact|anchor"
    - path: "frontend/src/components/strategy-graph/ForceGraphInner.tsx"
      provides: "Extended node types with anchor and strategy colors"
      contains: "anchor.*amber|strategy.*pink"
    - path: "frontend/src/app/(dashboard)/projects/[id]/timeline/page.tsx"
      provides: "Dual-mode timeline page (artifact milestones OR Kanban)"
      contains: "mvp_timeline.*artifact|MvpTimeline"
    - path: "frontend/src/components/timeline/MvpTimeline.tsx"
      provides: "New MVP timeline display component"
      contains: "milestone.*deliverables.*duration_weeks"
  key_links:
    - from: "frontend/src/app/(dashboard)/projects/[id]/strategy/page.tsx"
      to: "/api/artifacts/project/{project_id}"
      via: "apiFetch to get strategy_graph artifact"
      pattern: "apiFetch.*artifacts.*project.*strategy_graph"
    - from: "frontend/src/app/(dashboard)/projects/[id]/timeline/page.tsx"
      to: "/api/artifacts/project/{project_id}"
      via: "apiFetch to get mvp_timeline artifact"
      pattern: "apiFetch.*artifacts.*project.*mvp_timeline"
---

<objective>
Replace stub strategy graph and timeline pages with real artifact-driven displays. Strategy shows anchor nodes (user's words) and strategy nodes in a force graph. Timeline shows personalized MVP milestones with relative weeks.

Purpose: These two pages are the "This AI gets my idea" proof — the user sees their exact words organized into a real plan (strategy) and a concrete build timeline. Currently both pages only show Neo4j/Kanban system data, not personalized content.

Output: Strategy page with dual-mode (artifact graph when available, Neo4j fallback), Timeline page with dual-mode (MVP milestones when available, Kanban fallback), new MvpTimeline component.
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22.1-end-to-end-flow-strategy-graph-timeline-architecture-from-real-data/22.1-01-SUMMARY.md
@frontend/src/app/(dashboard)/projects/[id]/strategy/page.tsx
@frontend/src/app/(dashboard)/projects/[id]/timeline/page.tsx
@frontend/src/components/strategy-graph/ForceGraphInner.tsx
@frontend/src/components/strategy-graph/StrategyGraphCanvas.tsx
@frontend/src/components/timeline/KanbanBoard.tsx
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Strategy graph page — display anchor + strategy nodes from artifact</name>
  <files>
    frontend/src/app/(dashboard)/projects/[id]/strategy/page.tsx
    frontend/src/components/strategy-graph/ForceGraphInner.tsx
    frontend/src/components/strategy-graph/StrategyGraphCanvas.tsx
  </files>
  <action>
    **In ForceGraphInner.tsx:**
    1. Extend the `GraphNode` interface to include new types:
       ```typescript
       export interface GraphNode {
         id: string;
         type: "decision" | "milestone" | "artifact" | "anchor" | "strategy";
         title: string;  // for backward compat
         label?: string; // for new artifact nodes
         status: string;
         description?: string;
         x?: number;
         y?: number;
       }
       ```
    2. Extend `NODE_COLORS` with two new entries:
       ```typescript
       const NODE_COLORS = {
         decision: "#8B5CF6",   // violet
         milestone: "#10B981",  // emerald
         artifact: "#3B82F6",   // blue
         anchor: "#F59E0B",     // amber — user's own words
         strategy: "#EC4899",   // pink — LLM-derived strategy
       } as const;
       ```
    3. In the `nodeCanvasObject` render function, use `node.label ?? node.title` for the displayed text (anchor/strategy nodes use `label`, legacy nodes use `title`)
    4. Increase anchor node radius by 1.5x (`NODE_RADIUS * 1.5` for type "anchor") to make user's words visually prominent

    **In StrategyGraphCanvas.tsx:**
    - Update the re-exported `GraphNode` type to include the new types
    - Update the legend in the minimap to include Anchor (amber) and Strategy (pink) entries

    **In strategy page.tsx:**
    1. Add a new state variable `artifactGraph` to hold strategy graph artifact data
    2. On mount, FIRST try to fetch the strategy_graph artifact:
       ```typescript
       const artifactRes = await apiFetch(`/api/artifacts/project/${projectId}`, getToken);
       if (artifactRes.ok) {
         const artifacts = await artifactRes.json();
         const strategyArtifact = artifacts.find(
           (a: any) => a.artifact_type === "strategy_graph" && a.generation_status === "idle" && a.current_content
         );
         if (strategyArtifact) {
           // Convert artifact content to graph format
           const content = strategyArtifact.current_content;
           const nodes: GraphNode[] = (content.nodes || []).map((n: any) => ({
             id: n.id,
             type: n.type, // "anchor" or "strategy"
             title: n.label,
             label: n.label,
             status: n.status,
             description: n.description,
           }));
           const links: GraphLink[] = (content.edges || []).map((e: any) => ({
             source: e.source,
             target: e.target,
             relation: e.relation,
           }));
           setGraphData({ nodes, links });
           setLoading(false);
           return; // Skip Neo4j fetch
         }
       }
       ```
    3. FALLBACK: If no artifact found, fetch from Neo4j graph API (existing behavior)
    4. Update the page header subtitle to "Your strategy — built from your answers" when showing artifact data, "Decision relationships and project evolution" when showing Neo4j data
    5. When artifact graph is displayed, show the anchor_phrases as a small tag list above the graph:
       ```tsx
       {artifactGraph && artifactGraph.anchor_phrases && (
         <div className="flex flex-wrap gap-2 mb-4">
           {artifactGraph.anchor_phrases.map((phrase: string, i: number) => (
             <span key={i} className="text-xs px-2 py-1 rounded-full bg-amber-500/10 text-amber-400 border border-amber-500/20">
               &quot;{phrase}&quot;
             </span>
           ))}
         </div>
       )}
       ```
  </action>
  <verify>
    Run: `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit 2>&1 | head -20`
    TypeScript compiles without errors on the modified files.
  </verify>
  <done>Strategy page shows artifact-based force graph with amber anchor nodes (user's words) and pink strategy nodes. Falls back to Neo4j graph when no artifact exists. Anchor phrases displayed as tags above the graph. ForceGraphInner renders anchor nodes 1.5x larger.</done>
</task>

<task type="auto">
  <name>Task 2: Timeline page — display MVP milestones from artifact</name>
  <files>
    frontend/src/app/(dashboard)/projects/[id]/timeline/page.tsx
    frontend/src/components/timeline/MvpTimeline.tsx
  </files>
  <action>
    **Create `frontend/src/components/timeline/MvpTimeline.tsx`:**
    A new component that displays personalized MVP milestones. Design:

    ```tsx
    "use client";

    import { Clock, CheckCircle2, Package } from "lucide-react";

    interface Milestone {
      week: number;
      title: string;
      deliverables: string[];
      duration_weeks: number;
      description: string;
    }

    interface RoadmapPhase {
      phase: string;
      title: string;
      description: string;
      estimated_weeks: number;
    }

    interface MvpTimelineProps {
      milestones: Milestone[];
      longTermRoadmap: RoadmapPhase[];
      totalMvpWeeks: number;
      adaptedFor: string;
    }
    ```

    Layout:
    - Header showing total MVP weeks and "adapted_for" description in a subtle info bar
    - Vertical timeline with milestones as cards connected by a vertical line
    - Each milestone card shows:
      - Week badge (e.g., "Week 1-2") positioned on the timeline line
      - Title in semibold white
      - Description in text-sm text-white/60
      - Duration in text-xs (e.g., "2 weeks")
      - Deliverables as a bulleted list with small check icons, each deliverable in a pill/badge
    - Below the MVP milestones, a "Long-term Roadmap" section with lighter styling:
      - Phase cards with title, description, estimated weeks
      - Use dashed border and opacity-60 to visually distinguish from concrete MVP milestones

    Colors: Use brand/emerald theme for milestones, muted for long-term roadmap.
    Responsive: Single column on mobile, same on desktop (timeline is inherently vertical).

    **In timeline page.tsx:**
    1. Import `MvpTimeline` component
    2. Add state for `mvpTimelineData` to hold the artifact content
    3. On mount, FIRST try to fetch the mvp_timeline artifact:
       ```typescript
       const artifactRes = await apiFetch(`/api/artifacts/project/${projectId}`, getToken);
       if (artifactRes.ok) {
         const artifacts = await artifactRes.json();
         const timelineArtifact = artifacts.find(
           (a: any) => a.artifact_type === "mvp_timeline" && a.generation_status === "idle" && a.current_content
         );
         if (timelineArtifact) {
           setMvpTimelineData(timelineArtifact.current_content);
         }
       }
       ```
    4. Render: If `mvpTimelineData` exists, show `<MvpTimeline>` component. Below it (or in a tab), still show the Kanban board with system events.
    5. Update page header subtitle to "Your personalized MVP launch plan" when artifact exists, keep "Track project events and milestones" as default
  </action>
  <verify>
    Run: `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit 2>&1 | head -20`
    TypeScript compiles without errors. MvpTimeline.tsx exists and exports correctly.
  </verify>
  <done>Timeline page shows personalized MVP milestones from artifact with vertical timeline layout, week badges, deliverable pills, and long-term roadmap section. Falls back to Kanban when no artifact exists. MvpTimeline component created with responsive design.</done>
</task>

</tasks>

<verification>
- Strategy page shows anchor (amber) and strategy (pink) nodes from artifact when available
- Strategy page falls back to Neo4j graph when no strategy_graph artifact exists
- Timeline page shows MvpTimeline component with milestones when mvp_timeline artifact exists
- Timeline page still shows KanbanBoard (either below milestones or as fallback)
- TypeScript compiles without errors
- No existing page functionality broken
</verification>

<success_criteria>
Strategy and Timeline pages display personalized content from generated artifacts. Anchor nodes show user's verbatim words in amber. MVP milestones show relative weeks with concrete deliverables. Both pages gracefully fall back to existing displays when artifacts aren't available yet.
</success_criteria>

<output>
After completion, create `.planning/phases/22.1-end-to-end-flow-strategy-graph-timeline-architecture-from-real-data/22.1-03-SUMMARY.md`
</output>
