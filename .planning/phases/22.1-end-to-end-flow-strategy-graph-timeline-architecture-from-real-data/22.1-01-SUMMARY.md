---
phase: 22.1-end-to-end-flow
plan: "01"
subsystem: api
tags: [python, fastapi, enums, protocol, test-double, strategy-graph, mvp-timeline, app-architecture]

# Dependency graph
requires: []
provides:
  - ArtifactType.STRATEGY_GRAPH enum value ("strategy_graph")
  - ArtifactType.MVP_TIMELINE enum value ("mvp_timeline")
  - ArtifactType.APP_ARCHITECTURE enum value ("app_architecture")
  - Runner.generate_strategy_graph protocol method signature with full docstring
  - Runner.generate_mvp_timeline protocol method signature with full docstring
  - Runner.generate_app_architecture protocol method signature with full docstring
  - RunnerFake.generate_strategy_graph returning 6 anchor + 9 strategy nodes with edges
  - RunnerFake.generate_mvp_timeline returning 5 milestones (11 weeks) for bootstrapper tier
  - RunnerFake.generate_app_architecture returning 5 components with cost estimates
affects:
  - 22.1-02 (LLM generation — implements Runner methods using Anthropic)
  - 22.1-03 (auto-trigger — routes finalize to generate all 3 artifacts)
  - 22.1-04 (frontend display — renders all 3 artifact types)
  - 22.1-05 (E2E tests — uses RunnerFake for deterministic test doubles)
  - 22.1-06 (integration — wires end-to-end with real LLM calls)

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "StrEnum for ArtifactType — string-serializable enum for database and API storage"
    - "Runtime-checkable Protocol for Runner — enables isinstance() checks without inheritance"
    - "Scenario-based RunnerFake — deterministic test double with llm_failure and rate_limited scenarios"
    - "Finalize-triggered pipeline — new artifact types NOT in GENERATION_ORDER (separate trigger path)"

key-files:
  created: []
  modified:
    - backend/app/schemas/artifacts.py
    - backend/app/agent/runner.py
    - backend/app/agent/runner_fake.py

key-decisions:
  - "New artifact types (STRATEGY_GRAPH, MVP_TIMELINE, APP_ARCHITECTURE) are NOT added to GENERATION_ORDER — they have their own generation pipeline triggered from finalize, not the sequential brief pipeline"
  - "RunnerFake strategy graph returns 6 anchor + 9 strategy nodes (15 total) — anchor nodes use verbatim user phrases, strategy nodes use LLM-derived go-to-market labels"
  - "MVP Timeline adapted for bootstrapper tier — smaller scope, longer phases, no-code validation sprint in Week 1-2"
  - "App Architecture recommendations favor managed services (Render, Clerk, Resend) over AWS/self-hosted for bootstrapper tier"

patterns-established:
  - "Scenario guard pattern: every RunnerFake method checks llm_failure and rate_limited before any logic"
  - "Node schema: {id, type, label, description, status} for both anchor and strategy nodes"
  - "Cost estimate schema: {startup_monthly, scale_monthly, breakdown: [{component, cost, note}]}"
  - "Timeline milestone schema: {week, title, description, deliverables: list[str], duration_weeks}"

requirements-completed:
  - E2E-TYPES

# Metrics
duration: 12min
completed: 2026-02-21
---

# Phase 22.1 Plan 01: Backend Type System for Strategy Graph, Timeline, and Architecture Summary

**ArtifactType enum extended to 10 values and Runner protocol extended to 13 methods, with RunnerFake providing realistic test doubles for all 3 new artifact types (strategy_graph, mvp_timeline, app_architecture)**

## Performance

- **Duration:** ~12 min
- **Started:** 2026-02-20T21:35:00Z
- **Completed:** 2026-02-20T21:47:23Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments
- Extended ArtifactType enum from 7 to 10 values — STRATEGY_GRAPH, MVP_TIMELINE, APP_ARCHITECTURE — without breaking GENERATION_ORDER (these use a separate finalize-triggered pipeline)
- Extended Runner protocol from 10 to 13 public methods with complete docstrings specifying all Args, Returns, and data shapes
- Implemented RunnerFake with 3 realistic fake methods covering 6 anchor + 9 strategy nodes, 5-milestone timeline for bootstrapper, and 5-component architecture with cost estimates — all satisfying the Runner protocol

## Task Commits

Each task was committed atomically:

1. **Task 1: Add ArtifactType enum values and Runner protocol methods** - `4bb2a78` (feat)
2. **Task 2: Implement RunnerFake methods with realistic artifact data** - `3acf733` (feat)

**Plan metadata:** `[pending — docs commit]` (docs: complete plan)

## Files Created/Modified
- `backend/app/schemas/artifacts.py` - Added STRATEGY_GRAPH, MVP_TIMELINE, APP_ARCHITECTURE to ArtifactType enum; updated docstring to "Ten artifact types"
- `backend/app/agent/runner.py` - Added 3 new Protocol method signatures with full docstrings; updated module docstring to list 13 methods
- `backend/app/agent/runner_fake.py` - Added generate_strategy_graph, generate_mvp_timeline, generate_app_architecture with realistic fake data and scenario error handling

## Decisions Made
- New artifact types NOT added to GENERATION_ORDER — they trigger from finalize, not the sequential brief pipeline. This keeps the existing 5-artifact linear pipeline intact while enabling the new 3-artifact parallel generation.
- RunnerFake anchor nodes use verbatim inventory tracker phrases ("dead-simple inventory tracking", "barcode scanning", "$49/mo") that match the fake brief content, creating a realistic connected graph
- MVP Timeline adapted for bootstrapper tier — starts with a 2-week no-code validation sprint before any code, matching the non-technical founder use case
- App architecture recommendations favor managed services (Render, Clerk, Resend) over AWS infrastructure to match the bootstrapper tier's zero-DevOps requirement

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Plan 02 (LLM generation) can now implement the 3 Runner protocol methods using Anthropic Claude
- Plan 03 (auto-trigger) can route the finalize endpoint to call all 3 new methods
- Plan 04 (frontend display) can use ArtifactType enum values and RunnerFake for component development
- All downstream plans have type-safe contracts via the Runner Protocol and realistic test doubles via RunnerFake

---
*Phase: 22.1-end-to-end-flow*
*Completed: 2026-02-21*
