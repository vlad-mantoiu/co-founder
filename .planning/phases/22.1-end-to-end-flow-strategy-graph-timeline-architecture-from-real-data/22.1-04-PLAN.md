---
phase: 22.1-end-to-end-flow
plan: 04
type: execute
wave: 2
depends_on:
  - "22.1-01"
files_modified:
  - frontend/src/app/(dashboard)/projects/[id]/architecture/page.tsx
  - frontend/src/components/architecture/AppArchitectureView.tsx
autonomous: true
requirements:
  - E2E-ARCHITECTURE
must_haves:
  truths:
    - "Architecture page shows high-level component diagram with tech stack recommendations"
    - "Architecture page includes cost estimates ('~$50/mo to start, ~$200/mo at 1k users')"
    - "Components are simplified by default with expandable detail for curious/technical users"
    - "Architecture page falls back to session graph view for existing build sessions"
  artifacts:
    - path: "frontend/src/app/(dashboard)/projects/[id]/architecture/page.tsx"
      provides: "Dual-mode architecture page (artifact view OR session graph)"
      contains: "app_architecture.*artifact|AppArchitectureView"
    - path: "frontend/src/components/architecture/AppArchitectureView.tsx"
      provides: "New architecture display component with cost estimates"
      contains: "cost_estimate|tech_recommendation|components"
  key_links:
    - from: "frontend/src/app/(dashboard)/projects/[id]/architecture/page.tsx"
      to: "/api/artifacts/project/{project_id}"
      via: "apiFetch to get app_architecture artifact"
      pattern: "apiFetch.*artifacts.*project.*app_architecture"
---

<objective>
Replace the session-only architecture page with a dual-mode view: when an app_architecture artifact exists, show a component diagram with tech stack and cost estimates; fall back to session graph for existing build flows.

Purpose: Non-technical founders need to see what tech stack is recommended for their idea, with plain-English explanations and realistic cost estimates. The current architecture page only shows agent build session graphs which mean nothing to a non-technical user.

Output: New AppArchitectureView component, dual-mode architecture page.
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22.1-end-to-end-flow-strategy-graph-timeline-architecture-from-real-data/22.1-01-SUMMARY.md
@frontend/src/app/(dashboard)/projects/[id]/architecture/page.tsx
@frontend/src/components/graph/GraphCanvas.tsx
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AppArchitectureView component</name>
  <files>
    frontend/src/components/architecture/AppArchitectureView.tsx
  </files>
  <action>
    Create a new directory `frontend/src/components/architecture/` and a new file `AppArchitectureView.tsx`.

    The component displays a simplified architecture diagram with tech stack recommendations and cost estimates:

    **Props interface:**
    ```typescript
    interface ArchitectureComponent {
      name: string;
      type: "frontend" | "backend" | "database" | "auth" | "storage" | "other";
      description: string;
      tech_recommendation: string;
      alternatives: string[];
      detail_level: "simplified" | "expanded";
    }

    interface ArchitectureConnection {
      from_component: string;
      to_component: string;
      protocol: string;
      description: string;
    }

    interface CostBreakdown {
      component: string;
      cost: string;
      note: string;
    }

    interface CostEstimate {
      startup_monthly: string;
      scale_monthly: string;
      breakdown: CostBreakdown[];
    }

    interface AppArchitectureViewProps {
      components: ArchitectureComponent[];
      connections: ArchitectureConnection[];
      costEstimate: CostEstimate;
      integrationRecommendations: string[];
    }
    ```

    **Layout (top to bottom):**

    1. **Component diagram section** — A grid of component cards (2 cols on lg, 1 on mobile):
       - Each card shows: component type icon (use lucide: Monitor for frontend, Server for backend, Database for database, Shield for auth, HardDrive for storage, Box for other), component name in semibold, description in text-sm text-white/60, tech recommendation as a highlighted badge (e.g., "Next.js 14" in brand color)
       - **Expand/collapse toggle per card (LOCKED decision):** Each component card defaults to the simplified view (shows name, description, tech recommendation only). A "Show technical detail" button (ChevronDown icon) at the bottom of each card toggles expanded mode. When expanded:
         - Alternatives list appears prominently with "Alternatives:" heading and each alternative as a subtle chip/badge
         - A "Technical notes" section appears below showing the component's `description` in full technical detail (the LLM returns richer detail in the `description` field when `detail_level` is "expanded")
         - Button text changes to "Hide detail" with ChevronUp icon
       - Use local React state `expandedCards: Set<string>` (keyed by component name) to track which cards are expanded. Toggle on click.
       - Use framer-motion AnimatePresence for smooth height transition on expand/collapse

    2. **Connections section** — Below the grid, show connections as a simple list:
       - Each connection: "{from} → {to} via {protocol}" with description
       - Use subtle arrow styling with opacity-40 lines

    3. **Cost estimates section** — A prominent callout card:
       - Large display: startup_monthly in green text (e.g., "~$50/mo to start")
       - Secondary display: scale_monthly in amber text (e.g., "~$200/mo at 1k users")
       - Collapsible breakdown table: component | cost | note
       - Use DollarSign icon from lucide

    4. **Integration recommendations** — A simple list with lightbulb icons

    Colors: Use the glass-card pattern from the dashboard (bg-white/[0.02] rounded-xl border border-white/[0.06]). Type icons get colored backgrounds matching the component type (emerald for frontend, blue for backend, violet for database, amber for auth).
  </action>
  <verify>
    Run: `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit 2>&1 | head -20`
    TypeScript compiles. Component file exists at the correct path.
  </verify>
  <done>AppArchitectureView component created with component grid (each card has expand/collapse toggle showing alternatives and technical detail when expanded), connection diagram, cost estimate callout, and integration recommendations. Simplified by default with expandable detail for curious/technical users (LOCKED decision).</done>
</task>

<task type="auto">
  <name>Task 2: Dual-mode architecture page</name>
  <files>
    frontend/src/app/(dashboard)/projects/[id]/architecture/page.tsx
  </files>
  <action>
    Refactor the architecture page to support two modes:

    1. **Artifact mode** (default when app_architecture artifact exists): Show AppArchitectureView component
    2. **Session mode** (when ?session= param provided OR no artifact exists): Show existing GraphCanvas (current behavior)

    Changes:
    - Import `AppArchitectureView` from `@/components/architecture/AppArchitectureView`
    - Add state for `architectureData` to hold artifact content
    - On mount, fetch artifacts for the project:
      ```typescript
      const artifactRes = await apiFetch(`/api/artifacts/project/${projectId}`, getToken);
      if (artifactRes.ok) {
        const artifacts = await artifactRes.json();
        const archArtifact = artifacts.find(
          (a: any) => a.artifact_type === "app_architecture" && a.generation_status === "idle" && a.current_content
        );
        if (archArtifact) {
          setArchitectureData(archArtifact.current_content);
        }
      }
      ```
    - Rendering logic:
      - If `sessionId` param exists: show session graph (existing behavior — for build flow)
      - Else if `architectureData` exists: show `<AppArchitectureView>` with data from artifact
      - Else: show empty state with message "Complete the Understanding Interview to see your architecture recommendation"
    - Update page header: "Your App Architecture" when showing artifact, "Build Architecture" when showing session

    The empty state should link to understanding page: `<Link href={/projects/${projectId}/understanding}>Start Understanding Interview</Link>`

    Keep all existing session-mode code intact — this is a dual-mode addition, not a replacement.
  </action>
  <verify>
    Run: `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit 2>&1 | head -20`
    TypeScript compiles. Both modes work: artifact view renders when data exists, session view renders with ?session param.
  </verify>
  <done>Architecture page shows personalized tech stack + cost estimates from artifact. Falls back to session graph when ?session param provided. Shows helpful empty state with link to Understanding Interview when neither exists.</done>
</task>

</tasks>

<verification>
- Architecture page shows AppArchitectureView when app_architecture artifact exists
- Architecture page shows session GraphCanvas when ?session= param is provided
- Architecture page shows empty state with link when neither artifact nor session exists
- Cost estimates visible: startup monthly and scale monthly amounts
- Component cards show tech recommendations; "Show technical detail" button toggles alternatives and technical notes
- Each card defaults to simplified view; expanded view reveals alternatives prominently and technical detail
- TypeScript compiles without errors
- Existing build flow architecture view not broken
</verification>

<success_criteria>
Architecture page displays personalized tech stack recommendations and cost estimates from the generated artifact. Non-technical founders see "~$50/mo to start" and "Next.js 14" in plain English. Each component card is simplified by default with a "Show technical detail" toggle that reveals alternatives and technical notes for curious/technical users. Existing session graph view preserved for build flow.
</success_criteria>

<output>
After completion, create `.planning/phases/22.1-end-to-end-flow-strategy-graph-timeline-architecture-from-real-data/22.1-04-SUMMARY.md`
</output>
