---
phase: 14-stripe-live-activation
plan: 04
type: execute
wave: 2
depends_on:
  - "14-01"
files_modified:
  - frontend/src/components/marketing/pricing-content.tsx
autonomous: false
requirements:
  - BILL-04
  - BILL-07
  - BILL-08
user_setup:
  - service: stripe
    why: "Webhook endpoint registration for production"
    env_vars:
      - name: STRIPE_WEBHOOK_SECRET
        source: "Stripe Dashboard -> Developers -> Webhooks -> Signing secret (generated after endpoint creation)"
    dashboard_config:
      - task: "Register webhook endpoint URL"
        location: "Stripe Dashboard -> Developers -> Webhooks -> Add endpoint"
        details: "URL: https://api.cofounder.getinsourced.ai/api/webhooks/stripe | Events: checkout.session.completed, customer.subscription.updated, customer.subscription.deleted, invoice.payment_failed"
      - task: "Configure Customer Portal"
        location: "Stripe Dashboard -> Settings -> Customer Portal"
        details: "Set business name, enable: cancel subscription, update payment method, view invoices"
must_haves:
  truths:
    - "Pricing page checkout buttons initiate real Stripe Checkout sessions"
    - "Annual/monthly toggle correctly displays discounted annual prices"
    - "Annual pricing cards show 'billed annually' clarification"
    - "Stripe webhook endpoint is registered and verified in production"
  artifacts:
    - path: "frontend/src/components/marketing/pricing-content.tsx"
      provides: "Pricing page with annual/monthly toggle and checkout buttons"
      contains: "handleCheckout"
  key_links:
    - from: "frontend/src/components/marketing/pricing-content.tsx"
      to: "/api/billing/checkout"
      via: "apiFetch POST call in handleCheckout"
      pattern: "apiFetch.*billing/checkout"
---

<objective>
Verify and polish the existing checkout + pricing page wiring, add "billed annually" clarification, and register the Stripe webhook endpoint in production.

Purpose: The pricing page and checkout flow were built in v0.1 but need verification against the hardened backend. Annual pricing needs a "billed annually" note to set founder expectations (annual Price IDs charge the full year upfront). Webhook endpoint must be registered in Stripe Dashboard for production.

Output: Verified pricing page, annual billing clarification, operational webhook registration.
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-stripe-live-activation/14-RESEARCH.md
@.planning/phases/14-stripe-live-activation/14-01-SUMMARY.md
@frontend/src/components/marketing/pricing-content.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add annual billing clarification and verify pricing page wiring</name>
  <files>
    frontend/src/components/marketing/pricing-content.tsx
  </files>
  <action>
    1. Add "billed annually" text beneath the annual price display on each pricing card:
       - When annual toggle is active, add below the price: `<span className="text-xs text-white/30">billed annually</span>`
       - This clarifies that the displayed monthly rate is actually charged as a lump annual sum (per Research pitfall 6)

    2. Verify the following are correct (read-only check, fix only if broken):
       - `handleCheckout()` calls `apiFetch("/api/billing/checkout", getToken, { method: "POST", body: JSON.stringify({ plan_slug: slug, interval }) })`
       - `interval` is correctly set based on `annual` state: `annual ? "annual" : "monthly"`
       - Non-signed-in users redirect to `/sign-up?plan=${slug}&interval=${interval}`
       - The annual/monthly toggle correctly switches price display between `plan.monthlyPrice` and `plan.annualPrice`

    3. If any of the above are broken, fix them. If all correct, proceed without changes.
  </action>
  <verify>
    - `grep -n "billed annually" /Users/vladcortex/co-founder/frontend/src/components/marketing/pricing-content.tsx` shows the clarification text
    - `grep -n "handleCheckout\|billing/checkout" /Users/vladcortex/co-founder/frontend/src/components/marketing/pricing-content.tsx` confirms checkout wiring
  </verify>
  <done>Pricing page shows "billed annually" note when annual toggle is active; checkout flow verified working</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Register Stripe webhook endpoint and configure Customer Portal</name>
  <action>
    Register the Stripe webhook endpoint in the Stripe Dashboard for the production environment.
    This cannot be automated — it requires Stripe Dashboard access.
  </action>
  <instructions>
    **Step 1: Register webhook endpoint**
    1. Go to Stripe Dashboard -> Developers -> Webhooks -> Add endpoint
    2. URL: `https://api.cofounder.getinsourced.ai/api/webhooks/stripe`
    3. Select events:
       - `checkout.session.completed`
       - `customer.subscription.updated`
       - `customer.subscription.deleted`
       - `invoice.payment_failed`
    4. Click "Add endpoint"
    5. Copy the **Signing secret** (starts with `whsec_`)
    6. Update AWS Secrets Manager `cofounder/app` — add/update key `STRIPE_WEBHOOK_SECRET` with the signing secret value

    **Step 2: Configure Customer Portal**
    1. Go to Stripe Dashboard -> Settings -> Customer Portal
    2. Set Business name to "Co-Founder AI" (or your brand name)
    3. Enable features:
       - Cancel subscription
       - Update payment method
       - View invoices
    4. Save

    **Step 3: Verify STRIPE_PRICE_* env vars**
    1. Confirm all 6 price IDs are set in AWS Secrets Manager `cofounder/app`:
       - `STRIPE_PRICE_BOOTSTRAPPER_MONTHLY`
       - `STRIPE_PRICE_BOOTSTRAPPER_ANNUAL`
       - `STRIPE_PRICE_PARTNER_MONTHLY`
       - `STRIPE_PRICE_PARTNER_ANNUAL`
       - `STRIPE_PRICE_CTO_MONTHLY`
       - `STRIPE_PRICE_CTO_ANNUAL`
    2. If any are missing, create the corresponding Stripe Price objects in the Dashboard first

    Type "done" when all three steps are complete.
  </instructions>
  <resume-signal>Type "done" when webhook endpoint is registered, portal configured, and price IDs verified</resume-signal>
</task>

</tasks>

<verification>
1. Pricing page displays "billed annually" text when annual toggle is active
2. Checkout buttons still correctly call POST /api/billing/checkout
3. Annual/monthly toggle switches price display correctly
4. Stripe webhook endpoint registered at production URL
5. Customer Portal configured with cancel/update/invoices
6. All STRIPE_PRICE_* env vars set in production secrets
</verification>

<success_criteria>
- Pricing page verified working with annual clarification
- Stripe webhook endpoint registered and signing secret stored
- Customer Portal configured for subscription management
- All price IDs confirmed in production environment
</success_criteria>

<output>
After completion, create `.planning/phases/14-stripe-live-activation/14-04-SUMMARY.md`
</output>
