---
phase: 22-security-headers-baseline-audit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/22-security-headers-baseline-audit/baseline-scores.json
autonomous: true
requirements:
  - INFRA-02

must_haves:
  truths:
    - "Lighthouse scores for all 8 marketing pages are recorded for both mobile and desktop"
    - "All four category scores (Performance, Accessibility, Best Practices, SEO) are captured per page per mode"
    - "Core Web Vitals (LCP, CLS, FCP, TBT, SI, TTFB) are captured per page per mode"
    - "Scores represent the pre-optimization baseline (captured before any CSP or performance changes)"
  artifacts:
    - path: ".planning/phases/22-security-headers-baseline-audit/baseline-scores.json"
      provides: "Lighthouse baseline scores for all marketing pages"
      contains: "performance"
  key_links: []
---

<objective>
Run Lighthouse audits against the live marketing site (getinsourced.ai) for all 8 pages in both mobile and desktop modes, and record scores as the v0.4 pre-optimization baseline.

Purpose: Establish measurable baseline scores BEFORE any CSP or performance changes so later phases can track improvement.
Output: `baseline-scores.json` with all category scores and Core Web Vitals for every page.
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-security-headers-baseline-audit/22-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run Lighthouse audits and record baseline scores</name>
  <files>.planning/phases/22-security-headers-baseline-audit/baseline-scores.json</files>
  <action>
Run Lighthouse CLI audits against the live site for all 8 marketing pages in both mobile (default) and desktop (`--preset=desktop`) modes. Use `npx lighthouse` with `--output=json` and `--chrome-flags="--headless --no-sandbox --disable-gpu"` and `--quiet`.

Pages to audit (8 total):
- https://getinsourced.ai/ (homepage)
- https://getinsourced.ai/about/ (about)
- https://getinsourced.ai/cofounder/ (cofounder)
- https://getinsourced.ai/cofounder/how-it-works/ (cofounder-how-it-works)
- https://getinsourced.ai/contact/ (contact)
- https://getinsourced.ai/pricing/ (pricing)
- https://getinsourced.ai/privacy/ (privacy)
- https://getinsourced.ai/terms/ (terms)

For each page, run mobile first (no --preset flag), then desktop (--preset=desktop). Store raw JSON reports in a temp directory.

After all audits complete, extract scores from each JSON report and consolidate into a single `baseline-scores.json` file at `.planning/phases/22-security-headers-baseline-audit/baseline-scores.json`.

Score extraction per report:
- Categories: `report.categories.performance.score`, `report.categories.accessibility.score`, `report.categories['best-practices'].score`, `report.categories.seo.score` — multiply by 100 and round to integer.
- Core Web Vitals: `report.audits['largest-contentful-paint'].numericValue` (LCP ms), `report.audits['cumulative-layout-shift'].numericValue` (CLS), `report.audits['first-contentful-paint'].numericValue` (FCP ms), `report.audits['total-blocking-time'].numericValue` (TBT ms), `report.audits['speed-index'].numericValue` (SI ms), `report.audits['server-response-time'].numericValue` (TTFB ms). Round ms values to integer.
- INP: `report.audits['interaction-to-next-paint']?.numericValue` — may be null on static pages; record as null if absent.

Output format for baseline-scores.json:
```json
{
  "captured": "2026-02-20",
  "phase": "v0.4 pre-optimization baseline",
  "note": "Captured BEFORE custom CSP deployment (Phase 22 Plan 02)",
  "pages": [
    {
      "url": "https://getinsourced.ai/",
      "slug": "homepage",
      "mobile": {
        "performance": 72,
        "accessibility": 91,
        "bestPractices": 95,
        "seo": 98,
        "lcp_ms": 4200,
        "cls": 0.12,
        "fcp_ms": 1800,
        "tbt_ms": 240,
        "si_ms": 3100,
        "ttfb_ms": 180,
        "inp_ms": null
      },
      "desktop": { ... }
    }
  ]
}
```

Chrome must be available at `/Applications/Google Chrome.app/Contents/MacOS/Google Chrome`. Set `LIGHTHOUSE_CHROMIUM_PATH` env var to this path for each lighthouse invocation.

Clean up raw JSON report files after extraction — only keep the consolidated baseline-scores.json.

IMPORTANT: This must run against the LIVE site as it currently exists, before Plan 02 deploys the new CSP. The scores are the pre-change baseline.
  </action>
  <verify>
1. `cat .planning/phases/22-security-headers-baseline-audit/baseline-scores.json | python3 -c "import sys,json; d=json.load(sys.stdin); assert len(d['pages'])==8; [assert all(k in p['mobile'] for k in ['performance','accessibility','bestPractices','seo','lcp_ms','cls']) for p in d['pages']]; print('OK: 8 pages, all scores present')"` — validates structure.
2. Verify both mobile and desktop keys exist for every page entry.
3. Verify all 8 page slugs are present: homepage, about, cofounder, cofounder-how-it-works, contact, pricing, privacy, terms.
  </verify>
  <done>baseline-scores.json exists with all 8 pages, each having mobile and desktop scores with all 4 categories and 6+ Core Web Vitals metrics.</done>
</task>

</tasks>

<verification>
1. baseline-scores.json is valid JSON with 8 page entries
2. Each page has both `mobile` and `desktop` score objects
3. Each score object has all required fields (performance, accessibility, bestPractices, seo, lcp_ms, cls, fcp_ms, tbt_ms, si_ms, ttfb_ms)
4. Scores are reasonable (0-100 for categories, positive numbers for timing metrics)
</verification>

<success_criteria>
- baseline-scores.json exists at .planning/phases/22-security-headers-baseline-audit/baseline-scores.json
- All 8 marketing pages have both mobile and desktop Lighthouse scores
- All four Lighthouse categories captured per page per mode
- Core Web Vitals (LCP, CLS, FCP, TBT, SI, TTFB) captured per page per mode
- Scores are pre-change baseline (captured before CSP deployment)
</success_criteria>

<output>
After completion, create `.planning/phases/22-security-headers-baseline-audit/22-01-SUMMARY.md`
</output>
