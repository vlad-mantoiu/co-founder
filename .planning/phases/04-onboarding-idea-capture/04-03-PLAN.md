---
phase: 04-onboarding-idea-capture
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/app/(dashboard)/onboarding/page.tsx
  - frontend/src/app/(dashboard)/onboarding/layout.tsx
  - frontend/src/components/onboarding/IdeaInput.tsx
  - frontend/src/components/onboarding/ConversationalQuestion.tsx
  - frontend/src/components/onboarding/QuestionHistory.tsx
  - frontend/src/components/onboarding/ProgressBar.tsx
  - frontend/src/components/onboarding/ThesisSnapshot.tsx
  - frontend/src/hooks/useOnboarding.ts
autonomous: false

must_haves:
  truths:
    - "Dedicated full-screen onboarding page at /onboarding with no sidebar or dashboard chrome"
    - "Founder types idea with 'What are we building?' placeholder using 'we' language"
    - "One question at a time with conversational feel and mixed input types"
    - "Previous Q&A pairs visible above current question with edit capability"
    - "Progress bar fills as questions are answered"
    - "Skeleton shimmer loading state while waiting for question generation"
    - "ThesisSnapshot displays as card summary expandable to full document view"
    - "Inline editing of thesis sections with edits becoming canonical"
    - "Tier-gated sections show upgrade prompt for locked content"
  artifacts:
    - path: "frontend/src/app/(dashboard)/onboarding/page.tsx"
      provides: "Full-screen onboarding page"
      min_lines: 40
    - path: "frontend/src/components/onboarding/IdeaInput.tsx"
      provides: "Initial idea entry with smart expand prompt"
      min_lines: 40
    - path: "frontend/src/components/onboarding/ConversationalQuestion.tsx"
      provides: "One-question-at-a-time UI with mixed input types"
      min_lines: 60
    - path: "frontend/src/hooks/useOnboarding.ts"
      provides: "Session state management hook"
      min_lines: 80
  key_links:
    - from: "frontend/src/hooks/useOnboarding.ts"
      to: "/api/onboarding/*"
      via: "fetch calls to backend API"
      pattern: "fetch.*api/onboarding"
    - from: "frontend/src/app/(dashboard)/onboarding/page.tsx"
      to: "frontend/src/components/onboarding/*"
      via: "component imports"
      pattern: "import.*onboarding"
---

<objective>
Frontend onboarding flow: dedicated page, idea input, conversational questions, progress bar, ThesisSnapshot with inline editing

Purpose: Build the full-screen, focused onboarding experience where a founder enters their idea, answers LLM-tailored questions one at a time, and receives a tier-dependent ThesisSnapshot. This is the first user-facing feature of the product.

Output: Working onboarding page at /onboarding with complete UX flow from idea entry to ThesisSnapshot
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-onboarding-idea-capture/04-RESEARCH.md
@.planning/phases/04-onboarding-idea-capture/04-CONTEXT.md
@frontend/src/app/(dashboard)/layout.tsx
@frontend/src/middleware.ts
@frontend/src/components/ui/brand-nav.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: useOnboarding hook + IdeaInput + onboarding page layout</name>
  <files>
    frontend/src/hooks/useOnboarding.ts
    frontend/src/components/onboarding/IdeaInput.tsx
    frontend/src/app/(dashboard)/onboarding/layout.tsx
    frontend/src/app/(dashboard)/onboarding/page.tsx
  </files>
  <action>
    **useOnboarding hook** (`frontend/src/hooks/useOnboarding.ts`):
    Custom React hook managing the full onboarding session lifecycle. State machine with phases: "idle" | "idea_input" | "expanding" | "questioning" | "loading_question" | "finalizing" | "viewing_snapshot" | "error".

    State:
    - `phase`: Current UI phase
    - `sessionId`: string | null
    - `idea`: string
    - `questions`: OnboardingQuestion[]
    - `answers`: Record<string, string>
    - `currentQuestionIndex`: number
    - `totalQuestions`: number
    - `thesisSnapshot`: ThesisSnapshot | null
    - `thesisEdits`: Record<string, string>
    - `error`: string | null
    - `isLoading`: boolean

    TypeScript interfaces matching backend Pydantic schemas:
    ```typescript
    interface OnboardingQuestion {
      id: string;
      text: string;
      input_type: "text" | "textarea" | "multiple_choice";
      required: boolean;
      options?: string[];
      follow_up_hint?: string;
    }

    interface ThesisSnapshot {
      problem: string;
      target_user: string;
      value_prop: string;
      key_constraint: string;
      differentiation?: string | null;
      monetization_hypothesis?: string | null;
      assumptions?: string[] | null;
      risks?: string[] | null;
      smallest_viable_experiment?: string | null;
    }
    ```

    Methods:
    - `submitIdea(idea: string)`: POST /api/onboarding/start, transitions to "questioning" if >= 10 words, or "expanding" if < 10 words. On "expanding", show friendly prompt to elaborate, but allow proceeding anyway.
    - `submitAnswer(questionId: string, answer: string)`: POST /api/onboarding/{sessionId}/answer, advance index, show shimmer during transition, handle last question (auto-finalize or show finalize button).
    - `editAnswer(questionIndex: number)`: Set currentQuestionIndex to that index, allowing re-answer.
    - `finalize()`: POST /api/onboarding/{sessionId}/finalize, transition to "viewing_snapshot".
    - `editThesisField(fieldName: string, newValue: string)`: PATCH /api/onboarding/{sessionId}/thesis, update local state optimistically.
    - `resumeSession(sessionId: string)`: GET /api/onboarding/{sessionId}, restore state from response.
    - `reset()`: Return to "idea_input" phase.

    All API calls use `fetch` with credentials and auth headers. Get Clerk token via `useAuth()` from `@clerk/nextjs`. Handle errors with user-friendly messages.

    **IdeaInput component** (`frontend/src/components/onboarding/IdeaInput.tsx`):
    - Full-screen centered input with large heading "What are we building?" (per user decision — "we" language)
    - Single textarea for idea entry, auto-focus
    - Placeholder text: "Describe your startup idea in a sentence or two..."
    - Submit button "Let's go" (or Enter key)
    - If smart expand triggered (< 10 words), show friendly message below: "Tell us a bit more about your idea — even a couple more sentences helps us ask better questions." with a "Continue anyway" link and the textarea still visible for editing.
    - Clean, minimal, single-purpose (per user decision)
    - Dark theme matching existing app styling (bg-gray-950, text-white)

    **Onboarding layout** (`frontend/src/app/(dashboard)/onboarding/layout.tsx`):
    - Full-screen layout WITHOUT BrandNav or sidebar (per user decision: "dedicated onboarding page, full-screen focused flow, no sidebar or dashboard chrome")
    - Just renders children with minimal wrapper (padding, max-width centering)
    - Dark background, clean aesthetic

    **Onboarding page** (`frontend/src/app/(dashboard)/onboarding/page.tsx`):
    - "use client" directive
    - Uses useOnboarding hook
    - Renders appropriate component based on phase:
      - "idle" / "idea_input": IdeaInput
      - "expanding": IdeaInput with expand prompt
      - "questioning" / "loading_question": QuestionHistory + ConversationalQuestion (or skeleton)
      - "finalizing": Loading state with "Generating your Thesis Snapshot..."
      - "viewing_snapshot": ThesisSnapshot component
      - "error": Error message with retry button
    - Check for existing sessions on mount (GET /api/onboarding/sessions), if found show "Welcome back! Continue where you left off, or start fresh?" choice screen (per user decision)
    - Page title: "Onboarding | Co-Founder"
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes without type errors
    - `ls frontend/src/app/\(dashboard\)/onboarding/page.tsx frontend/src/hooks/useOnboarding.ts frontend/src/components/onboarding/IdeaInput.tsx` — all files exist
    - Page renders at /onboarding route (verify via `npm run build` succeeds)
  </verify>
  <done>
    useOnboarding hook manages full session lifecycle with API integration. IdeaInput shows "What are we building?" with smart expand prompt. Onboarding page routes through phases correctly. Layout is full-screen without dashboard chrome.
  </done>
</task>

<task type="auto">
  <name>Task 2: ConversationalQuestion + QuestionHistory + ProgressBar + ThesisSnapshot</name>
  <files>
    frontend/src/components/onboarding/ConversationalQuestion.tsx
    frontend/src/components/onboarding/QuestionHistory.tsx
    frontend/src/components/onboarding/ProgressBar.tsx
    frontend/src/components/onboarding/ThesisSnapshot.tsx
  </files>
  <action>
    **ConversationalQuestion** (`frontend/src/components/onboarding/ConversationalQuestion.tsx`):
    - Displays one question at a time with AnimatePresence transition (framer-motion)
    - Dynamic input based on `input_type`:
      - "text": Single-line input with placeholder
      - "textarea": Multi-line textarea (3-4 rows) with placeholder
      - "multiple_choice": List of option buttons (click to select, highlighted when selected)
    - Show follow_up_hint as gray subtext below question if present
    - Question text styled as large heading (text-2xl)
    - Submit button "Next" (or "Finish" for last question)
    - Keyboard: Enter submits for text/multiple_choice, Cmd+Enter for textarea
    - Auto-focus input on mount
    - Skeleton shimmer loading state (use Tailwind animate-pulse with gray bars — avoid adding react-loading-skeleton dependency to keep bundle small, Tailwind pulse is sufficient):
      ```tsx
      // Skeleton shimmer
      <div className="space-y-4 animate-pulse">
        <div className="h-8 bg-white/10 rounded w-3/4" />
        <div className="h-24 bg-white/10 rounded" />
      </div>
      ```

    **QuestionHistory** (`frontend/src/components/onboarding/QuestionHistory.tsx`):
    - Scrollable list of previously answered Q&A pairs
    - Each entry shows: question text (gray), answer text (white), "Edit" button
    - Click "Edit" sets currentQuestionIndex back to that position (via onEdit callback)
    - Styled with reduced opacity (opacity-60) to de-emphasize vs current question
    - No "Are you sure?" confirmation on edit (per user decision: seamless editing, no friction)

    **ProgressBar** (`frontend/src/components/onboarding/ProgressBar.tsx`):
    - Visual progress bar showing question completion
    - Shows "Question X of Y" text and percentage
    - Animated fill using CSS transition (Tailwind transition-all duration-500)
    - Gradient fill (from-blue-500 to-purple-500 matching existing design)
    - Progress = current_question_index / total_questions * 100 (integer truncation per Phase 02 pattern)
    - Fixed at top of question area so it's always visible

    **ThesisSnapshot** (`frontend/src/components/onboarding/ThesisSnapshot.tsx`):
    - Hybrid presentation (per user decision): card summary at top, expandable to full document
    - Card summary shows: Problem (1-line), Target User (1-line), Value Prop (1-line), Key Constraint (1-line) — truncated with "..." and expand icon
    - "View Full Snapshot" button expands to full document view with all sections
    - Each section has "Edit" button that switches to inline editing mode:
      - Use controlled textarea (not contentEditable — simpler and more reliable in React)
      - On blur or "Save" click, call editThesisField callback
      - Edits are optimistic (update local state immediately)
    - Tier-gated sections (per user decision):
      - If field is null (tier-gated), show locked section with:
        - Lock icon
        - Section title
        - Brief description of what the section contains
        - "Upgrade to [Partner/CTO] plan" CTA button linking to /pricing
        - Blurred/dimmed background effect
    - "Create Project" button at bottom (links to project creation — will be wired in Plan 04)
    - "Start Fresh" button to reset and begin new onboarding

    All components use Tailwind CSS for styling. Dark theme: bg-gray-950 background, white text, white/10 borders, white/5 card backgrounds. Use existing design patterns from the marketing site components.
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes without type errors
    - All 4 component files exist and export default/named components
    - `npm run build` succeeds (no build errors)
  </verify>
  <done>
    ConversationalQuestion renders one question at a time with mixed input types, skeleton shimmer, and keyboard navigation. QuestionHistory shows scrollable previous Q&A with seamless edit. ProgressBar animates fill as questions are answered. ThesisSnapshot shows hybrid card/document view with inline editing and tier-gated locked sections with upgrade prompts. All components use Tailwind dark theme.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of onboarding flow</name>
  <files>frontend/src/app/(dashboard)/onboarding/page.tsx</files>
  <action>
    Visual verification of the complete onboarding UI flow. What was built: idea input with "What are we building?", one-question-at-a-time conversational interface with progress bar, and ThesisSnapshot with card summary and inline editing.

    Steps to verify:
    1. Start the frontend dev server: `cd frontend && npm run dev`
    2. Navigate to http://localhost:3000/onboarding
    3. Verify: Full-screen page with no sidebar/nav chrome, "What are we building?" heading
    4. Type a short idea (< 10 words like "Food delivery app") and verify expand prompt appears
    5. Type a longer idea (>= 10 words) and submit
    6. Verify: Questions appear one at a time with progress bar
    7. Answer questions and verify: previous Q&A visible above, progress bar fills
    8. Verify: Mixed input types appear (text, textarea, multiple choice)
    9. Click "Edit" on a previous answer — verify it navigates back without confirmation
    10. Complete all questions and verify ThesisSnapshot appears
    11. Verify: Card summary view with expand to full document
    12. Click "Edit" on a thesis section — verify inline editing works
    13. Check that locked tier sections show upgrade prompt (if testing as bootstrapper)

    Resume signal: Type "approved" or describe issues
  </action>
  <verify>Human visual verification of onboarding flow at http://localhost:3000/onboarding</verify>
  <done>All 13 verification steps pass visual inspection. Onboarding flow works end-to-end from idea input through ThesisSnapshot viewing.</done>
</task>

</tasks>

<verification>
1. /onboarding page is full-screen, no dashboard chrome (per user decision)
2. "What are we building?" placeholder with "we" language (per user decision)
3. Smart expand prompt for < 10 word ideas
4. One question at a time with skeleton shimmer during transitions
5. Previous Q&A visible and editable without friction
6. Progress bar fills as answers submitted
7. ThesisSnapshot shows card summary + expandable full view
8. Inline editing with canonical persistence
9. Tier-gated sections show locked state with upgrade CTA
10. TypeScript builds without errors
</verification>

<success_criteria>
- Full-screen dedicated onboarding page at /onboarding
- Complete UX flow: idea input -> questions -> ThesisSnapshot
- Conversational one-at-a-time questions with mixed input types
- Progress bar, skeleton shimmer, question history with edit
- ThesisSnapshot hybrid view with inline editing
- Tier-gated sections with upgrade prompts
- Visual verification passed by user
</success_criteria>

<output>
After completion, create `.planning/phases/04-onboarding-idea-capture/04-03-SUMMARY.md`
</output>
