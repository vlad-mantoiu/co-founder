---
phase: 09-strategy-graph-timeline
plan: 04
type: execute
wave: 3
depends_on: ["09-02", "09-03"]
files_modified:
  - frontend/src/app/(dashboard)/timeline/page.tsx
  - frontend/src/components/timeline/KanbanBoard.tsx
  - frontend/src/components/timeline/KanbanColumn.tsx
  - frontend/src/components/timeline/TimelineCard.tsx
  - frontend/src/components/timeline/TimelineSearch.tsx
  - frontend/src/components/ui/brand-nav.tsx
autonomous: true

must_haves:
  truths:
    - "Timeline page renders 4-column Kanban board (Backlog/Planned/In Progress/Done)"
    - "Timeline cards show title, type badge, and date — click opens shared NodeDetailModal"
    - "Cards ordered newest first within each column"
    - "Search bar filters timeline by text, type (decision/milestone/artifact), and date range"
    - "Timeline items include 'View in graph' link that navigates to /strategy?project=X&node=Y"
    - "BrandNav includes Strategy and Timeline navigation links"
  artifacts:
    - path: "frontend/src/app/(dashboard)/timeline/page.tsx"
      provides: "Timeline Kanban page"
      contains: "KanbanBoard"
    - path: "frontend/src/components/timeline/KanbanBoard.tsx"
      provides: "4-column Kanban layout"
      contains: "COLUMNS"
    - path: "frontend/src/components/timeline/TimelineSearch.tsx"
      provides: "Search and filter controls"
      contains: "TimelineSearch"
  key_links:
    - from: "frontend/src/app/(dashboard)/timeline/page.tsx"
      to: "/api/timeline/{project_id}"
      via: "apiFetch in useEffect"
      pattern: "apiFetch.*timeline"
    - from: "frontend/src/components/timeline/TimelineCard.tsx"
      to: "frontend/src/components/strategy-graph/NodeDetailModal.tsx"
      via: "shared modal import"
      pattern: "NodeDetailModal"
    - from: "frontend/src/components/ui/brand-nav.tsx"
      to: "frontend/src/app/(dashboard)/strategy/page.tsx"
      via: "navLinks href"
      pattern: "/strategy"
---

<objective>
Kanban timeline board with search/filter and navigation integration.

Purpose: Deliver the 4-column Kanban board that shows project events (decisions, milestones, artifacts) organized by status. Cards open the shared NodeDetailModal for detail. Search and filter let founders find specific events. Navigation links added to BrandNav for Strategy and Timeline.

Output: Timeline page, KanbanBoard components, TimelineSearch, and BrandNav updates.
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-strategy-graph-timeline/09-RESEARCH.md
@.planning/phases/09-strategy-graph-timeline/09-03-SUMMARY.md

# Key source files:
@frontend/src/components/strategy-graph/NodeDetailModal.tsx  # Shared modal to reuse
@frontend/src/components/ui/brand-nav.tsx                     # Nav to update
@frontend/src/lib/api.ts                                     # apiFetch pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Kanban board components with timeline cards</name>
  <files>
    frontend/src/components/timeline/KanbanBoard.tsx
    frontend/src/components/timeline/KanbanColumn.tsx
    frontend/src/components/timeline/TimelineCard.tsx
  </files>
  <action>
    Create `frontend/src/components/timeline/KanbanBoard.tsx`:
    - "use client" directive
    - Define columns constant (locked decision — 4 columns):
      ```typescript
      const COLUMNS = [
        { id: "backlog", label: "Backlog", color: "border-white/10" },
        { id: "planned", label: "Planned", color: "border-blue-500/30" },
        { id: "in_progress", label: "In Progress", color: "border-brand/30" },
        { id: "done", label: "Done", color: "border-emerald-500/30" },
      ] as const;
      ```

    - Props: `{ items: TimelineItem[], onCardClick: (item: TimelineItem) => void }`
    - Group items by `kanban_status` into columns
    - Sort within each column by timestamp descending (newest first — locked decision)
    - Render `KanbanColumn` for each column
    - Layout: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 h-full`
    - No drag-drop — system-driven status only (locked decision)

    - Empty state per column: show dashed border empty placeholder with "No items" text
    - Overall empty state (no items at all): centered message similar to strategy graph

    Create `frontend/src/components/timeline/KanbanColumn.tsx`:
    - Props: `{ label: string, color: string, items: TimelineItem[], onCardClick }`, count badge
    - Header: column label + count badge (e.g., "Done (3)")
    - Body: scrollable list of TimelineCards
    - Styling: `border-t-2 ${color}` top accent, `bg-white/[0.02] rounded-xl p-3`
    - Column scrolls independently: `overflow-y-auto max-h-[calc(100vh-18rem)]`

    Create `frontend/src/components/timeline/TimelineCard.tsx`:
    - Props: `{ item: TimelineItem, onClick: () => void }`
    - Minimal card (locked decision): title + type badge + date
    - Type badge: colored pill matching graph node colors (violet=decision, emerald=milestone, blue=artifact)
    - Date: relative time format (e.g., "2 days ago") using simple date formatter — or absolute "Feb 15" for older
    - Title: truncated to 2 lines with `line-clamp-2`
    - Click: calls onClick prop (opens shared modal)
    - Hover: subtle background change `hover:bg-white/5 transition-colors`
    - Card styling: `p-3 rounded-lg bg-white/[0.03] border border-white/5 cursor-pointer`
    - "View in graph" small link/icon at bottom of card — navigates to `/strategy?project=${item.project_id}&highlight=${item.graph_node_id}` (locked decision — user controls context switch, no auto-navigation)
      - Only show if `item.graph_node_id` is not null
      - Use `<Link>` from next/link with `text-xs text-brand hover:text-brand/80`

    Define shared TypeScript interface for TimelineItem (matching backend schema):
    ```typescript
    interface TimelineItem {
      id: string;
      project_id: string;
      timestamp: string;
      type: "decision" | "milestone" | "artifact";
      title: string;
      summary: string;
      kanban_status: "backlog" | "planned" | "in_progress" | "done";
      graph_node_id: string | null;
      build_version: string | null;
      decision_id: string | null;
      debug_id: string | null;
    }
    ```

    Claude's discretion on card click animation: use a subtle `active:scale-[0.98]` transform on click for tactile feedback.
  </action>
  <verify>
    `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit 2>&1 | head -30` — no new TypeScript errors.
    Verify KanbanBoard has 4 columns matching locked decision.
    Verify TimelineCard shows title + type badge + date.
    Verify no drag-drop functionality exists.
    Verify cards have "View in graph" link when graph_node_id is present.
  </verify>
  <done>
    KanbanBoard renders 4 columns (Backlog/Planned/In Progress/Done).
    TimelineCards display title, type badge, date. Click triggers onCardClick.
    Cards ordered newest first within each column.
    "View in graph" link on cards navigates to strategy page.
    No drag-drop — system-driven read-only board.
    Empty states for columns and overall board.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create timeline page with search/filter and add nav links</name>
  <files>
    frontend/src/app/(dashboard)/timeline/page.tsx
    frontend/src/components/timeline/TimelineSearch.tsx
    frontend/src/components/ui/brand-nav.tsx
  </files>
  <action>
    Create `frontend/src/components/timeline/TimelineSearch.tsx`:
    - "use client" directive
    - Props: `{ onSearch: (params: SearchParams) => void }`
    - SearchParams: `{ query: string, typeFilter: string | null, dateFrom: string | null, dateTo: string | null }`
    - Layout: horizontal bar with:
      1. Text input: `placeholder="Search timeline..."` with Search icon (lucide), debounced 300ms
      2. Type filter: select/dropdown with options "All Types", "Decisions", "Milestones", "Artifacts"
      3. Date range: two date inputs (from/to) — use native `<input type="date" />` for simplicity
    - Styling: glass-strong bar with `flex items-center gap-3 p-3 rounded-xl border border-white/5 bg-white/[0.02]`
    - On any change: call `onSearch` with current params

    Create `frontend/src/app/(dashboard)/timeline/page.tsx`:
    - "use client" directive
    - Page title: "Timeline" with subtitle "Track project events and milestones"
    - Project ID: from URL search param `?project=uuid` (same pattern as strategy page)
    - If no project param, show project picker or message to select a project

    - State: `items` (TimelineItem[]), `loading`, `error`, `searchParams`
    - Fetch: `apiFetch("/api/timeline/${projectId}?query=...&type_filter=...&date_from=...&date_to=...", getToken)`
    - Re-fetch when searchParams change (useEffect dependency)
    - Build query string from searchParams, omitting null values

    - Render order:
      1. Page header (title + subtitle)
      2. `TimelineSearch` with `onSearch` callback updating searchParams state
      3. `KanbanBoard` with items and `onCardClick` opening NodeDetailModal
      4. `NodeDetailModal` (imported from strategy-graph/) with `showGraphLink={true}` and `onViewInGraph` navigating to `/strategy?project=${projectId}&highlight=${nodeId}`

    - Loading state: skeleton grid matching 4 columns
    - Error state: error message with retry
    - Empty search results: "No matching items found" with suggestion to clear filters

    Update `frontend/src/components/ui/brand-nav.tsx`:
    - Add "Strategy" and "Timeline" to the navLinks array:
      ```typescript
      const navLinks = [
        { href: "/dashboard", label: "Dashboard" },
        { href: "/projects", label: "Projects" },
        { href: "/strategy", label: "Strategy" },
        { href: "/timeline", label: "Timeline" },
        { href: "/chat", label: "Chat" },
        { href: "/architecture", label: "Architecture" },
        { href: "/billing", label: "Billing" },
      ] as const;
      ```
    - Place Strategy and Timeline after Projects, before Chat (logical flow: manage projects -> see strategy -> see timeline -> advanced tools)
    - No other changes to BrandNav needed — existing active-state logic works automatically

    NOTE on "View in graph" navigation: When `onViewInGraph` is called from the timeline modal, use `router.push(`/strategy?project=${projectId}&highlight=${nodeId}`)` via next/navigation `useRouter`. The strategy page should read `highlight` search param to auto-focus that node (auto-zoom via `graphRef.current?.centerAt(node.x, node.y, 1000)`) — but this is a nice-to-have. At minimum, navigating to the strategy page with the project context is sufficient.
  </action>
  <verify>
    `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit 2>&1 | head -30` — no new TypeScript errors.
    Verify timeline page fetches from /api/timeline/ endpoint.
    Verify TimelineSearch has text input, type filter dropdown, and date range inputs.
    Verify BrandNav has "Strategy" and "Timeline" links.
    Verify NodeDetailModal is imported from strategy-graph/ (shared component).
    Verify "View in graph" navigates to /strategy page.
  </verify>
  <done>
    Timeline page at /timeline renders KanbanBoard with items from API.
    TimelineSearch provides text search, type filter, and date range filter (TIME-03).
    Cards open shared NodeDetailModal (locked decision — same modal as graph).
    "View in graph" link in modal navigates to strategy page (locked decision — no auto-navigation).
    BrandNav updated with Strategy and Timeline links.
    Search re-fetches with debounced query params.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. KanbanBoard renders 4 columns with correct labels
3. TimelineSearch has 3 filter types (text, type, date range)
4. TimelineCard shows title + type badge + date
5. NodeDetailModal reused from strategy-graph/ (not duplicated)
6. BrandNav shows Strategy and Timeline links
7. Timeline items link to strategy graph via "View in graph"
8. Cards are read-only (no drag-drop)
</verification>

<success_criteria>
- TIME-02: Timeline rendered as Kanban board with 4 statuses (Backlog/Planned/In Progress/Done)
- TIME-03: Tickets expandable (via shared modal) and queryable (text + type + date range)
- TIME-01: Timeline items display timestamp, type, title, summary
- Cards ordered newest first within columns (locked decision)
- System-driven status only, no manual changes (locked decision)
- "View in graph" link on timeline items (locked decision — no auto-navigation)
- Modal reused from graph (locked decision — shared component)
- Navigation links in BrandNav for both Strategy and Timeline
</success_criteria>

<output>
After completion, create `.planning/phases/09-strategy-graph-timeline/09-04-SUMMARY.md`
</output>
