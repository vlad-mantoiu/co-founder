---
phase: 10-export-deploy-readiness-e2e-testing
plan: 08
type: execute
wave: 3
depends_on: ["10-04"]
files_modified:
  - frontend/src/components/build/BuildProgressBar.tsx
  - frontend/src/components/build/BuildSummary.tsx
  - frontend/src/components/build/BuildFailureCard.tsx
  - frontend/src/hooks/useBuildProgress.ts
  - frontend/src/app/(dashboard)/company/[id]/build/page.tsx
autonomous: true

must_haves:
  truths:
    - "Build progress bar shows named stages (Scaffolding, Writing code, Installing deps, Running checks)"
    - "On failure: friendly summary with retry button, no technical details unless expanded"
    - "On success: summary of what was built with preview link"
    - "Build cancellation supported with confirmation dialog"
    - "Progress updates via SSE from /api/jobs/{job_id}/stream"
  artifacts:
    - path: "frontend/src/components/build/BuildProgressBar.tsx"
      provides: "Step-by-step build progress bar with named stages"
      contains: "Scaffolding"
    - path: "frontend/src/components/build/BuildSummary.tsx"
      provides: "Build success summary with preview link"
      contains: "preview"
    - path: "frontend/src/components/build/BuildFailureCard.tsx"
      provides: "Friendly failure card with retry button"
      contains: "retry"
    - path: "frontend/src/hooks/useBuildProgress.ts"
      provides: "SSE hook for real-time build status"
      contains: "EventSource"
  key_links:
    - from: "frontend/src/hooks/useBuildProgress.ts"
      to: "backend/app/api/routes/jobs.py"
      via: "SSE stream /api/jobs/{job_id}/stream"
      pattern: "EventSource.*stream"
    - from: "frontend/src/components/build/BuildProgressBar.tsx"
      to: "frontend/src/hooks/useBuildProgress.ts"
      via: "useBuildProgress hook"
      pattern: "useBuildProgress"
---

<objective>
Build progress UI components: progress bar, success summary, failure card, cancellation dialog.

Purpose: Per locked decisions — step-by-step progress bar with named stages, friendly failure with retry, success summary with preview link, cancellation with confirmation. This is the visual representation of the generation loop.

Output: Build UI components, SSE progress hook, build page.
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-export-deploy-readiness-e2e-testing/10-RESEARCH.md
@.planning/phases/10-export-deploy-readiness-e2e-testing/10-04-SUMMARY.md

@frontend/src/hooks/useAgentStream.ts
@frontend/src/app/(dashboard)/layout.tsx
@frontend/src/components/ui/brand-nav.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build progress hook and progress bar component</name>
  <files>frontend/src/hooks/useBuildProgress.ts, frontend/src/components/build/BuildProgressBar.tsx</files>
  <action>
    **Create `frontend/src/hooks/useBuildProgress.ts`:**

    Custom hook that connects to SSE endpoint and tracks build stage:

    ```typescript
    const STAGE_LABELS: Record<string, string> = {
      queued: "Waiting in queue...",
      starting: "Starting build...",
      scaffold: "Scaffolding workspace...",
      code: "Writing code...",
      deps: "Installing dependencies...",
      checks: "Running checks...",
      ready: "Build complete!",
      failed: "Build failed",
    };

    const STAGE_ORDER = ["queued", "starting", "scaffold", "code", "deps", "checks", "ready"];

    export function useBuildProgress(jobId: string | null) {
      const [status, setStatus] = useState<string>("queued");
      const [label, setLabel] = useState("Waiting in queue...");
      const [previewUrl, setPreviewUrl] = useState<string | null>(null);
      const [error, setError] = useState<string | null>(null);
      const [stageIndex, setStageIndex] = useState(0);

      useEffect(() => {
        if (!jobId) return;
        const eventSource = new EventSource(`${process.env.NEXT_PUBLIC_API_URL}/api/jobs/${jobId}/stream`);
        // ... handle messages, update status/label/stageIndex/previewUrl/error
        // Close on terminal states (ready, failed)
        return () => eventSource.close();
      }, [jobId]);

      return { status, label, previewUrl, error, stageIndex, totalStages: STAGE_ORDER.length };
    }
    ```

    **Create `frontend/src/components/build/BuildProgressBar.tsx`:**

    "use client" component that renders a step-by-step progress bar per locked decision:
    - Named stages shown as horizontal steps: Scaffolding → Writing code → Installing deps → Running checks → Complete
    - Current stage highlighted with brand color + animated pulse
    - Completed stages show checkmark
    - Future stages dimmed
    - Use framer-motion for smooth transitions between stages (Claude's discretion: loading animation)
    - No raw terminal output (locked decision)
    - Uses Tailwind for all styling

    Props: `{ stageIndex: number, totalStages: number, label: string, status: string }`

    The progress bar should look like a wizard/stepper — each stage is a circle with a line connecting to the next. Active stage pulses. Use the brand color palette from the existing codebase.
  </action>
  <verify>
    Verify files exist and import correctly:
    `cd /Users/vladcortex/co-founder && npx tsc --noEmit frontend/src/hooks/useBuildProgress.ts frontend/src/components/build/BuildProgressBar.tsx 2>&1 | head -20` — no type errors.
  </verify>
  <done>useBuildProgress hook connects to SSE and tracks build stages. BuildProgressBar renders step-by-step named stages with animations. Per locked decision: no raw terminal output.</done>
</task>

<task type="auto">
  <name>Task 2: Build success, failure, cancellation components and build page</name>
  <files>frontend/src/components/build/BuildSummary.tsx, frontend/src/components/build/BuildFailureCard.tsx, frontend/src/app/(dashboard)/company/[id]/build/page.tsx</files>
  <action>
    **Create `frontend/src/components/build/BuildSummary.tsx`:**
    Per locked decision: "On success: quick summary of what was built (files, features, stack) with preview link below"

    Props: `{ buildVersion: string, previewUrl: string, fileCount?: number, features?: string[], stack?: string }`
    - Shows build version badge ("build v0.1")
    - Summary card: "Your MVP is ready!" with list of key details
    - Preview link as prominent CTA button: "Open Preview" linking to previewUrl (opens in new tab)
    - Subtle "View in Dashboard" link below

    **Create `frontend/src/components/build/BuildFailureCard.tsx`:**
    Per locked decision: "On failure: friendly summary with retry button — no technical details unless founder expands"

    Props: `{ errorMessage: string, debugId: string, onRetry: () => void }`
    - Friendly message: "We hit an issue. Want us to try again?"
    - Retry button (prominent, brand color)
    - Expandable details section (collapsed by default): shows error message and debug_id
    - Debug ID displayed for support reference

    **Create build page `frontend/src/app/(dashboard)/company/[id]/build/page.tsx`:**

    Page that orchestrates the build flow:
    1. Accepts project_id from URL params
    2. Uses useBuildProgress hook with the active job_id (from URL query param or context)
    3. Shows BuildProgressBar while building
    4. Shows BuildSummary on success
    5. Shows BuildFailureCard on failure
    6. Cancel button in top-right during build — opens confirmation dialog (shadcn AlertDialog):
       - "Are you sure you want to cancel this build? Progress will be lost."
       - On confirm: POST /api/generation/{job_id}/cancel
    7. Per locked decision: "Build cancellation supported with confirmation dialog — stops agent and cleans up partial work"

    Use framer-motion AnimatePresence for transitions between states (building → success, building → failure).
  </action>
  <verify>
    `cd /Users/vladcortex/co-founder && npx tsc --noEmit frontend/src/app/\(dashboard\)/company/\[id\]/build/page.tsx 2>&1 | head -20` — no type errors.
    Verify all 3 build components exist in frontend/src/components/build/.
  </verify>
  <done>Build success summary shows preview link. Failure card has retry + expandable details. Build page orchestrates flow with cancel dialog. All locked UI decisions implemented.</done>
</task>

</tasks>

<verification>
- BuildProgressBar shows named stages with animations
- BuildSummary shows preview link on success
- BuildFailureCard has retry button and expandable details
- Build page has cancel button with confirmation dialog
- useBuildProgress hook streams from SSE endpoint
- No raw terminal output shown to user
</verification>

<success_criteria>
- TypeScript compilation passes for all new components
- Build components exist in frontend/src/components/build/
- Build page exists at company/[id]/build/
- useBuildProgress hook exists with SSE connection
</success_criteria>

<output>
After completion, create `.planning/phases/10-export-deploy-readiness-e2e-testing/10-08-SUMMARY.md`
</output>
