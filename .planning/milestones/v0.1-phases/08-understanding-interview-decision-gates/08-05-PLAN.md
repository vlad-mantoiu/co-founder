---
phase: 08-understanding-interview-decision-gates
plan: 05
type: execute
wave: 3
depends_on: ["08-02", "08-03", "08-04"]
files_modified:
  - frontend/src/components/decision-gates/DecisionGateModal.tsx
  - frontend/src/components/decision-gates/GateOptionCard.tsx
  - frontend/src/components/decision-gates/NarrowPivotForm.tsx
  - frontend/src/components/execution-plans/PlanComparisonTable.tsx
  - frontend/src/components/execution-plans/PlanOptionCard.tsx
  - frontend/src/hooks/useDecisionGate.ts
  - frontend/src/hooks/useExecutionPlans.ts
autonomous: true

must_haves:
  truths:
    - "Decision Gate 1 shows as full-screen modal blocking everything"
    - "Modal shows 4 rich cards: Proceed/Narrow/Pivot/Park with description, pros/cons, what happens next"
    - "Narrow/Pivot shows text field for scope change description"
    - "Park shows optional note field"
    - "After Proceed, comparison table shows 2-3 execution plan options"
    - "Comparison table has rows for time, cost, risk, scope"
    - "Recommended option has badge + brand-colored border"
    - "Full breakdown per option: time, cost, risk, scope, pros, cons, approach"
    - "Select or regenerate buttons available"
  artifacts:
    - path: "frontend/src/components/decision-gates/DecisionGateModal.tsx"
      provides: "Full-screen modal for Decision Gate 1"
      exports: ["DecisionGateModal"]
    - path: "frontend/src/components/decision-gates/GateOptionCard.tsx"
      provides: "Rich card for each gate option"
      exports: ["GateOptionCard"]
    - path: "frontend/src/components/execution-plans/PlanComparisonTable.tsx"
      provides: "Feature-by-feature comparison grid"
      exports: ["PlanComparisonTable"]
    - path: "frontend/src/hooks/useDecisionGate.ts"
      provides: "Hook for gate state management"
      exports: ["useDecisionGate"]
    - path: "frontend/src/hooks/useExecutionPlans.ts"
      provides: "Hook for execution plan state management"
      exports: ["useExecutionPlans"]
  key_links:
    - from: "frontend/src/hooks/useDecisionGate.ts"
      to: "/api/gates/*"
      via: "fetch calls to gate API"
      pattern: "fetch.*api/gates"
    - from: "frontend/src/hooks/useExecutionPlans.ts"
      to: "/api/plans/*"
      via: "fetch calls to plans API"
      pattern: "fetch.*api/plans"
    - from: "frontend/src/components/decision-gates/DecisionGateModal.tsx"
      to: "frontend/src/components/decision-gates/GateOptionCard.tsx"
      via: "Card composition in modal grid"
      pattern: "GateOptionCard"
---

<objective>
Build Decision Gate full-screen modal and Execution Plan comparison table frontend components with state management hooks.

Purpose: Decision Gate 1 is the most critical UX moment in the product -- the founder must deliberately choose their path forward. The full-screen modal ensures this decision gets the ceremony it deserves. The comparison table then helps the founder make an informed build path choice with analytical clarity.

Output: DecisionGateModal, GateOptionCard, NarrowPivotForm, PlanComparisonTable, PlanOptionCard, 2 state hooks
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-understanding-interview-decision-gates/08-CONTEXT.md
@.planning/phases/08-understanding-interview-decision-gates/08-RESEARCH.md

@.planning/phases/08-understanding-interview-decision-gates/08-02-SUMMARY.md
@.planning/phases/08-understanding-interview-decision-gates/08-03-SUMMARY.md
@.planning/phases/08-understanding-interview-decision-gates/08-04-SUMMARY.md

@frontend/src/components/ui/brand-nav.tsx
@frontend/src/hooks/useOnboarding.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Decision Gate Modal + Hooks</name>
  <files>
    frontend/src/hooks/useDecisionGate.ts
    frontend/src/components/decision-gates/DecisionGateModal.tsx
    frontend/src/components/decision-gates/GateOptionCard.tsx
    frontend/src/components/decision-gates/NarrowPivotForm.tsx
  </files>
  <action>
1. Create `hooks/useDecisionGate.ts` — State management for decision gate:
   - State: { isOpen: boolean, gateId: string | null, options: GateOption[], selectedOption: string | null, isResolving: boolean, error: string | null, resolution: { decision: string, summary: string } | null }
   - `openGate(projectId: string)` — GET /api/gates/project/{projectId}/pending. If pending gate exists, set isOpen=true with gate data. If no pending gate, POST /api/gates/create to create one.
   - `selectOption(value: string)` — Set selectedOption locally (no API call yet).
   - `resolveGate(actionText?: string, parkNote?: string)` — POST /api/gates/{gateId}/resolve with decision + action_text/park_note. Set resolution on success. Close modal.
   - `closeGate()` — Reset state, set isOpen=false.
   - `checkBlocking(projectId: string)` — GET /api/gates/project/{projectId}/check-blocking. Returns boolean.

2. Create `components/decision-gates/GateOptionCard.tsx` — Rich card for one gate option:
   - Props: option (GateOption), isSelected: boolean, onSelect: () => void
   - Card layout matching research pattern:
     - Header: title + Selected badge (shadcn Badge) when active
     - Description text
     - "What happens next" section
     - Pros list (green bullet color) / Cons list (red bullet color) in 2-column grid
     - "Why you might choose this" italic blurb at bottom (border-t separator)
   - Selected state: ring-2 ring-brand shadow-glow border treatment (per locked decision: badge + border)
   - Hover state: ring-1 ring-white/20 transition
   - Click handler: calls onSelect
   - Use shadcn Card, CardHeader, CardContent, Badge

3. Create `components/decision-gates/NarrowPivotForm.tsx` — Text input for narrow/pivot action:
   - Props: type ("narrow" | "pivot"), value: string, onChange: (value: string) => void
   - Textarea (6 rows per research pitfall 6 recommendation) with guidance text
   - Label: "How should we narrow?" (narrow) or "What's the pivot?" (pivot)
   - Helper text: "Be specific: What are we cutting? What are we keeping?" (narrow) or "Describe the new direction. The more detail, the better we can update your brief." (pivot)
   - Placeholder text with examples per research
   - Uses shadcn Textarea

4. Create `components/decision-gates/DecisionGateModal.tsx` — Full-screen modal per locked decision:
   - Props: isOpen, onClose, gateId, projectId, briefSummary (current brief context), onResolved
   - Uses shadcn Dialog with fullscreen class: `max-w-7xl h-screen max-h-screen p-0 gap-0`
   - Layout:
     - Header (border-b): "Decision Gate 1: Direction" title (text-3xl font-display). Subtitle: "This is a critical decision point. Review your Idea Brief, then choose your path forward."
     - Brief context panel (below header, muted background): Shows current brief summary (problem, target, value prop, truncated to 100 chars each) with "View full brief" link. Per research pitfall 4: modal MUST show brief context.
     - Options grid (2x2 cards in main area): Renders 4 GateOptionCard components in grid-cols-2 layout
     - Conditional forms: NarrowPivotForm appears below grid when narrow or pivot selected. Park shows optional note textarea.
     - Footer (border-t): Cancel button (ghost) on left. "Confirm Decision" button on right (disabled until option selected, min-w-[200px]). Loading state while resolving.
   - Escape key and Cancel button close modal
   - Full attention: modal blocks everything (per locked decision: "this is a critical decision moment deserving full attention and ceremony")
   - After resolution: calls onResolved callback with decision outcome
  </action>
  <verify>
    Run `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit --pretty 2>&1 | head -20` — no TypeScript errors.
    Verify files exist: `ls frontend/src/hooks/useDecisionGate.ts frontend/src/components/decision-gates/DecisionGateModal.tsx frontend/src/components/decision-gates/GateOptionCard.tsx frontend/src/components/decision-gates/NarrowPivotForm.tsx`
  </verify>
  <done>
    DecisionGateModal renders as full-screen modal with brief context, 4 rich option cards (Proceed/Narrow/Pivot/Park), conditional input forms for narrow/pivot/park, and confirm button. GateOptionCard shows description, pros/cons, what happens next, and why to choose. useDecisionGate hook manages gate lifecycle. TypeScript compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Execution Plan Comparison Table + Hooks</name>
  <files>
    frontend/src/hooks/useExecutionPlans.ts
    frontend/src/components/execution-plans/PlanComparisonTable.tsx
    frontend/src/components/execution-plans/PlanOptionCard.tsx
  </files>
  <action>
1. Create `hooks/useExecutionPlans.ts` — State management for execution plans:
   - State: { options: ExecutionOption[], recommendedId: string, selectedId: string | null, isGenerating: boolean, isSelecting: boolean, planSetId: string | null, error: string | null }
   - `generatePlans(projectId: string, feedback?: string)` — POST /api/plans/generate (or /api/plans/regenerate if plans exist). Handles 409 (gate not resolved) with helpful error message.
   - `selectPlan(projectId: string, optionId: string)` — POST /api/plans/{projectId}/select. Sets selectedId on success.
   - `regeneratePlans(projectId: string, feedback: string)` — POST /api/plans/regenerate with feedback. Replaces options.
   - `loadExistingPlans(projectId: string)` — GET /api/plans/{projectId}. Loads if already generated.

2. Create `components/execution-plans/PlanComparisonTable.tsx` — Feature-by-feature comparison grid per locked decision:
   - Props: options (ExecutionOption[]), onSelect (optionId: string) => void, onRegenerate () => void, isGenerating: boolean
   - Table layout with 4 critical comparison rows (per research, not 15):
     - "Time to Ship" — renders option.time_to_ship as text
     - "Engineering Cost" — renders option.engineering_cost as text
     - "Risk Level" — renders as colored Badge (green=low, yellow=medium, red=high)
     - "Scope Coverage" — renders as percentage with progress bar (bg-brand fill)
   - Column headers: option name + "Recommended" badge for is_recommended=true option (per locked decision: badge + brand-colored border)
   - Recommended column has ring-2 ring-brand border treatment (not pre-selected per research anti-pattern)
   - Overflow-x-auto for responsiveness
   - "Generate Different Options" ghost button below table (per locked decision: select or regenerate)
   - Loading state with skeleton shimmer during generation

3. Create `components/execution-plans/PlanOptionCard.tsx` — Detailed breakdown per option:
   - Props: option (ExecutionOption), isRecommended: boolean, onSelect () => void
   - Card layout below comparison table (grid-cols-1 md:grid-cols-3):
     - Header: option name
     - Technical Approach section (1-2 sentence summary)
     - Pros list (green) / Cons list (red) in 2-column grid
     - Tradeoffs list
     - Engineering Impact + Cost Note (DCSN-02 fields)
     - "Select This Plan" button (default variant for recommended, outline for others)
   - Recommended card has ring-2 ring-brand border treatment
   - Per locked decision: full breakdown per option with all fields visible
  </action>
  <verify>
    Run `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit --pretty 2>&1 | head -20` — no TypeScript errors.
    Run `cd /Users/vladcortex/co-founder/frontend && npm run build 2>&1 | tail -5` — build succeeds.
    Verify files exist: `ls frontend/src/hooks/useExecutionPlans.ts frontend/src/components/execution-plans/PlanComparisonTable.tsx frontend/src/components/execution-plans/PlanOptionCard.tsx`
  </verify>
  <done>
    PlanComparisonTable renders side-by-side grid with 4 critical rows (time, cost, risk, scope). Recommended option has badge + brand border (not pre-selected). PlanOptionCard shows full breakdown with technical approach, pros/cons, tradeoffs, engineering impact, cost note. Select or regenerate buttons available. useExecutionPlans hook manages plan lifecycle with 409 handling. TypeScript compiles and build succeeds.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- `npm run build` succeeds
- DecisionGateModal renders with full-screen overlay
- 4 GateOptionCards render with Proceed/Narrow/Pivot/Park
- PlanComparisonTable renders 3 columns with 4 rows
- Recommended option has badge + border treatment
- NarrowPivotForm shows textarea for scope changes
</verification>

<success_criteria>
- Full-screen modal for Decision Gate 1 (locked decision)
- Rich cards per option with description, pros/cons, what happens next (locked decision)
- Narrow/Pivot shows edit prompt textarea (locked decision)
- Park shows archive with note field (locked decision)
- Comparison table layout for build paths (locked decision)
- Recommended option: badge + border (locked decision)
- Full breakdown per option (locked decision)
- Select or regenerate buttons (locked decision)
- Brief context visible in gate modal (research pitfall 4)
</success_criteria>

<output>
After completion, create `.planning/phases/08-understanding-interview-decision-gates/08-05-SUMMARY.md`
</output>
