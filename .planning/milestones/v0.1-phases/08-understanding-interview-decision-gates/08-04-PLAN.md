---
phase: 08-understanding-interview-decision-gates
plan: 04
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - frontend/src/hooks/useUnderstandingInterview.ts
  - frontend/src/components/understanding/AdaptiveInterview.tsx
  - frontend/src/components/understanding/InterviewQuestion.tsx
  - frontend/src/components/understanding/InterviewHistory.tsx
  - frontend/src/components/understanding/IdeaBriefView.tsx
  - frontend/src/components/understanding/IdeaBriefCard.tsx
  - frontend/src/components/understanding/ConfidenceIndicator.tsx
  - frontend/src/app/(dashboard)/understanding/page.tsx
  - frontend/src/app/(dashboard)/understanding/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Founder sees one question at a time during the understanding interview"
    - "Skeleton shimmer shows between questions (consistent with Phase 4)"
    - "Founder can navigate back and edit previous answers"
    - "Editing a previous answer re-adapts subsequent questions"
    - "Completing the interview shows the Rationalised Idea Brief"
    - "Brief displays as card summary with expand for full sections"
    - "Each section shows confidence indicator (Strong/Moderate/Needs depth)"
    - "Founder can inline-edit brief sections"
    - "Re-interview button resets for major changes"
  artifacts:
    - path: "frontend/src/hooks/useUnderstandingInterview.ts"
      provides: "State machine hook for understanding interview lifecycle"
      exports: ["useUnderstandingInterview"]
    - path: "frontend/src/components/understanding/AdaptiveInterview.tsx"
      provides: "Main interview container with phase-based rendering"
      exports: ["AdaptiveInterview"]
    - path: "frontend/src/components/understanding/IdeaBriefView.tsx"
      provides: "Idea Brief display with expandable card sections"
      exports: ["IdeaBriefView"]
    - path: "frontend/src/app/(dashboard)/understanding/page.tsx"
      provides: "Understanding interview page at /understanding"
  key_links:
    - from: "frontend/src/hooks/useUnderstandingInterview.ts"
      to: "/api/understanding/*"
      via: "fetch calls to understanding API"
      pattern: "fetch.*api/understanding"
    - from: "frontend/src/components/understanding/IdeaBriefView.tsx"
      to: "frontend/src/components/understanding/IdeaBriefCard.tsx"
      via: "Card component composition"
      pattern: "IdeaBriefCard"
    - from: "frontend/src/components/understanding/IdeaBriefCard.tsx"
      to: "frontend/src/components/understanding/ConfidenceIndicator.tsx"
      via: "Confidence badge rendering"
      pattern: "ConfidenceIndicator"
---

<objective>
Build the Understanding Interview frontend: adaptive one-question-at-a-time interview with back-navigation, Rationalised Idea Brief display with expandable cards, confidence indicators, and inline editing.

Purpose: The understanding interview is a conversation with the AI co-founder that deepens the founder's idea into an investor-quality brief. The UX must feel like talking to a smart co-founder, not filling out a form. Per locked decisions: one question at a time, skeleton shimmer, back-navigation with re-adaptation, card summary + expand, confidence indicators, inline editing + re-interview.

Output: useUnderstandingInterview hook, 6 UI components, understanding page with layout
</objective>

<execution_context>
@/Users/vladcortex/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vladcortex/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-understanding-interview-decision-gates/08-CONTEXT.md
@.planning/phases/08-understanding-interview-decision-gates/08-RESEARCH.md

@.planning/phases/08-understanding-interview-decision-gates/08-01-SUMMARY.md

@frontend/src/hooks/useOnboarding.ts
@frontend/src/components/onboarding/ConversationalQuestion.tsx
@frontend/src/components/onboarding/QuestionHistory.tsx
@frontend/src/components/onboarding/ThesisSnapshot.tsx
@frontend/src/app/(dashboard)/onboarding/page.tsx
@frontend/src/app/(dashboard)/onboarding/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: useUnderstandingInterview Hook + Interview Components</name>
  <files>
    frontend/src/hooks/useUnderstandingInterview.ts
    frontend/src/components/understanding/InterviewQuestion.tsx
    frontend/src/components/understanding/InterviewHistory.tsx
    frontend/src/app/(dashboard)/understanding/layout.tsx
  </files>
  <action>
1. Create `hooks/useUnderstandingInterview.ts` — State machine hook managing the understanding interview lifecycle. Follow the useOnboarding.ts pattern but adapted for understanding interview:

   State phases: "idle" | "starting" | "questioning" | "loading_next" | "editing_answer" | "finalizing" | "viewing_brief" | "re_interviewing" | "error"

   State shape:
   ```typescript
   interface UnderstandingState {
     phase: string;
     sessionId: string | null;
     currentQuestion: UnderstandingQuestion | null;
     questionNumber: number;
     totalQuestions: number;
     answeredQuestions: { question: UnderstandingQuestion; answer: string }[];
     brief: RationalisedIdeaBrief | null;
     artifactId: string | null;
     briefVersion: number;
     error: string | null;
   }
   ```

   Methods:
   - `startInterview(onboardingSessionId: string)` — POST /api/understanding/start. Sets phase to "questioning" with first question.
   - `submitAnswer(questionId: string, answer: string)` — POST /api/understanding/{sessionId}/answer. Shows skeleton shimmer during loading_next. On is_complete=true, auto-finalize. Otherwise show next question.
   - `editAnswer(questionId: string, newAnswer: string)` — PATCH /api/understanding/{sessionId}/answer. Updates answeredQuestions. If regenerated=true, update question list. Show skeleton shimmer during re-adaptation.
   - `navigateBack(questionIndex: number)` — Jump to a previous question for editing. Sets phase to "editing_answer". Show the question with current answer pre-filled.
   - `finalize()` — POST /api/understanding/{sessionId}/finalize. Sets phase to "viewing_brief" with brief data.
   - `editBriefSection(sectionKey: string, newContent: string)` — PATCH /api/understanding/{projectId}/brief. Optimistic update, then sync.
   - `reInterview()` — POST /api/understanding/{sessionId}/re-interview. Resets to "starting" phase.
   - `resumeSession(sessionId: string)` — GET /api/understanding/{sessionId}. Loads existing session state.

   Error handling: Catch fetch errors, set phase="error" with friendly message. Include debug_id from response if available.

2. Create `components/understanding/InterviewQuestion.tsx` — Single question display (one at a time per locked decision):
   - Props: question (UnderstandingQuestion), onSubmit (answer: string) => void, isLoading: boolean, initialAnswer?: string (for edit mode)
   - Renders question text with "we" co-founder framing
   - Input type: text input for "text", textarea (4 rows min) for "textarea", radio/card group for "multiple_choice"
   - Skeleton shimmer (Tailwind animate-pulse + bg-white/10 bars) when isLoading=true (3 lines of varying width, matching Phase 4 pattern)
   - Submit via Enter (text/choice) or Cmd+Enter (textarea)
   - Follow-up hint shown as muted text below input
   - Framer Motion AnimatePresence for question transitions

3. Create `components/understanding/InterviewHistory.tsx` — Scrollable previous Q&A with edit capability:
   - Props: answeredQuestions (array), onEdit (index: number) => void, currentIndex: number
   - Renders answered questions as compact cards (question + truncated answer)
   - Click on any previous answer to edit (calls onEdit with index)
   - Visual indicator for current question position
   - Subtle separator between answered and upcoming

4. Create `app/(dashboard)/understanding/layout.tsx` — Full-screen layout:
   - Same pattern as onboarding layout (no sidebar chrome, full-screen focus)
   - Dark background consistent with brand
   - Maximum width container for readability
  </action>
  <verify>
    Run `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit --pretty 2>&1 | head -20` — no TypeScript errors in new files.
    Verify files exist: `ls frontend/src/hooks/useUnderstandingInterview.ts frontend/src/components/understanding/InterviewQuestion.tsx frontend/src/components/understanding/InterviewHistory.tsx frontend/src/app/\(dashboard\)/understanding/layout.tsx`
  </verify>
  <done>
    useUnderstandingInterview hook manages 8 phases with full interview lifecycle. InterviewQuestion renders one question at a time with skeleton shimmer between questions. InterviewHistory shows previous Q&A with edit capability. Full-screen layout matches Phase 4 onboarding pattern. TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Idea Brief Display + Confidence Indicators + Understanding Page</name>
  <files>
    frontend/src/components/understanding/IdeaBriefView.tsx
    frontend/src/components/understanding/IdeaBriefCard.tsx
    frontend/src/components/understanding/ConfidenceIndicator.tsx
    frontend/src/app/(dashboard)/understanding/page.tsx
  </files>
  <action>
1. Create `components/understanding/ConfidenceIndicator.tsx`:
   - Props: confidence ("strong" | "moderate" | "needs_depth")
   - Renders a badge with icon and label:
     - "strong" → green CheckCircle icon + "Strong" text
     - "moderate" → yellow AlertCircle icon + "Needs refinement" text (discretion: wording)
     - "needs_depth" → red AlertCircle icon + "Needs depth" text
   - Uses shadcn Badge component with appropriate variant
   - Compact design (fits in card header)

2. Create `components/understanding/IdeaBriefCard.tsx` — Expandable card for one brief section:
   - Props: section (key, title, summary, fullContent, confidence), onEdit (sectionKey, newContent) => void, isEditing: boolean
   - Uses shadcn Card + Collapsible (Radix primitive via shadcn)
   - Collapsed state: shows title + summary (first 100 chars) + ConfidenceIndicator badge
   - Expanded state: shows full content with inline edit button
   - Inline editing: controlled textarea (per Phase 4 locked decision), Save/Cancel buttons
   - Optimistic update: calls onEdit, shows updated content immediately
   - ChevronDown icon rotates on expand (Tailwind transition-transform)
   - Click anywhere on header to toggle (CollapsibleTrigger)

3. Create `components/understanding/IdeaBriefView.tsx` — Full Idea Brief display:
   - Props: brief (RationalisedIdeaBrief), onEditSection, onReInterview, artifactId, version
   - Maps brief sections to IdeaBriefCard components in this order (discretion):
     1. Problem Statement
     2. Target User
     3. Value Proposition
     4. Differentiation
     5. Market Context
     6. Monetization Hypothesis
     7. Key Constraints
     8. Assumptions (renders as bullet list)
     9. Risks (renders as bullet list)
     10. Smallest Viable Experiment
   - Header: "Rationalised Idea Brief" title with version badge ("v{version}")
   - Investor-facing tone label: "This brief is formatted for investor communication" (per locked decision)
   - "Re-interview" button at bottom (calls onReInterview) — for major changes per locked decision
   - "Edit inline" capability on each card — for small tweaks per locked decision
   - Section summaries generated from first sentence of each section's content

4. Create `app/(dashboard)/understanding/page.tsx` — Main understanding page:
   - "use client" directive
   - Uses useUnderstandingInterview hook
   - Phase-based rendering:
     - "idle": Start button or session picker (if resumable sessions exist)
     - "starting" / "loading_next": Skeleton shimmer animation
     - "questioning" / "editing_answer": InterviewQuestion (current) + InterviewHistory (previous). Show progress: "Question {n} of {total}"
     - "finalizing": Loading state with "Generating your Idea Brief..." message
     - "viewing_brief": IdeaBriefView with full brief display
     - "re_interviewing": Loading state transitioning back to questioning
     - "error": Error message with retry button and debug_id if available
   - Receives onboardingSessionId from query params or navigation state
   - Full-screen layout (uses understanding layout)
   - Back navigation: "Back to Dashboard" link in top-left corner
  </action>
  <verify>
    Run `cd /Users/vladcortex/co-founder/frontend && npx tsc --noEmit --pretty 2>&1 | head -20` — no TypeScript errors.
    Run `cd /Users/vladcortex/co-founder/frontend && npm run build 2>&1 | tail -5` — build succeeds.
    Verify files exist: `ls frontend/src/components/understanding/IdeaBriefView.tsx frontend/src/components/understanding/IdeaBriefCard.tsx frontend/src/components/understanding/ConfidenceIndicator.tsx frontend/src/app/\(dashboard\)/understanding/page.tsx`
  </verify>
  <done>
    IdeaBriefView renders brief as card summary + expand layout with 10 sections. Each card shows confidence indicator (Strong/Needs refinement/Needs depth). Inline editing via controlled textarea with optimistic updates. Re-interview button for major changes. Understanding page renders full flow from idle through questioning to brief viewing. TypeScript compiles and build succeeds.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- `npm run build` succeeds
- Understanding page exists at /understanding route
- useUnderstandingInterview hook exports from hooks/
- IdeaBriefView renders expandable cards
- ConfidenceIndicator shows 3 states
- InterviewQuestion shows skeleton shimmer between questions
</verification>

<success_criteria>
- One question at a time during interview (locked decision)
- Skeleton shimmer between questions (locked decision, Phase 4 pattern)
- Back-navigation with re-adaptation capability (locked decision)
- Card summary + expand for brief sections (locked decision)
- Per-section confidence indicators (locked decision)
- Inline editing + re-interview button (locked decision)
- Investor-facing tone in brief display (locked decision)
- Full-screen focus layout (matches Phase 4 onboarding)
</success_criteria>

<output>
After completion, create `.planning/phases/08-understanding-interview-decision-gates/08-04-SUMMARY.md`
</output>
